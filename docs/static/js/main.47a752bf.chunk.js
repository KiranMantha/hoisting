(this["webpackJsonpye-mario"]=this["webpackJsonpye-mario"]||[]).push([[0],{36:function(t,e,i){t.exports=i(52)},41:function(t,e,i){},43:function(t,e,i){},52:function(t,e,i){"use strict";i.r(e);var s=i(0),h=i.n(s),a=i(20),r=i.n(a),n=(i(41),i(10)),o=i(11),l=i(13),c=i(12),d=i(14),u=(i(42),i(19)),p=i(15),m=(i(43),{}),g={};m.GameCanvas=function(){this.Canvas=null,this.Context2D=null,this.BackBuffer=null,this.BackBufferContext2D=null},m.GameCanvas.prototype={Initialize:function(t,e,i){this.Canvas=document.getElementById(t),this.Context2D=this.Canvas.getContext("2d"),this.BackBuffer=document.createElement("canvas"),this.BackBuffer.width=e,this.BackBuffer.height=i,this.BackBufferContext2D=this.BackBuffer.getContext("2d")},BeginDraw:function(){this.BackBufferContext2D.clearRect(0,0,this.BackBuffer.width,this.BackBuffer.height),this.Context2D.clearRect(0,0,this.Canvas.width,this.Canvas.height)},EndDraw:function(){this.Context2D.drawImage(this.BackBuffer,0,0,this.BackBuffer.width,this.BackBuffer.height,0,0,this.Canvas.width,this.Canvas.height)}};var S=i(3),f=i.n(S);m.Keys={A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:80,Left:37,Up:38,Right:39,Down:40,Space:32},m.KeyboardInput={Pressed:{},Initialize:function(t){var e=this,i=!1,s=window.document||window.document.body||window;s.onkeydown=function(t){e.KeyDownEvent(t)},s.onkeyup=function(t){e.KeyUpEvent(t)},t&&(s.addEventListener("touchstart",(function(t){var s=t.target.getAttribute("data-type")||t.target.parentElement.getAttribute("data-type");i||"83"!==s||(i=!i,f()(document).trigger("enterGame")),t.keyCode=s,e.KeyDownEvent(t)}),!1),s.addEventListener("touchend",(function(t){t.keyCode=t.target.getAttribute("data-type")||t.target.parentElement.getAttribute("data-type"),e.KeyUpEvent(t)}),!1))},IsKeyDown:function(t){return null!=this.Pressed[t]&&this.Pressed[t]},KeyDownEvent:function(t){this.Pressed[t.keyCode]=!0,this.PreventScrolling(t)},KeyUpEvent:function(t){this.Pressed[t.keyCode]=!1,this.PreventScrolling(t)},PreventScrolling:function(t){if(t.keyCode>=32&&t.keyCode<=40){var e=t||window.event;0!==e.type.indexOf("touch")&&(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0,e.returnValue=!1)}}},m.Resources={Images:{},Sounds:{},Destroy:function(){return delete this.Images,delete this.Sounds,this},AddImage:function(t,e){var i=new Image;return this.Images[t]=i,i.src=e,this},AddImages:function(t){for(var e=0;e<t.length;e++){var i=new Image;this.Images[t[e].name]=i,i.src=t[e].src}return this},ClearImages:function(){return delete this.Images,this.Images=new Object,this},RemoveImage:function(t){return delete this.Images[t],this},AddSound:function(t,e,i){this.Sounds[t]=[],this.Sounds[t].index=0,i||(i=3);for(var s=0;s<i;s++)this.Sounds[t][s]=new Audio(e);return this},ClearSounds:function(){return delete this.Sounds,this.Sounds={},this},RemoveSound:function(t){return delete this.Sounds[t],this},PlaySound:function(t,e){return this.Sounds[t].index>=this.Sounds[t].length&&(this.Sounds[t].index=0),e&&this.Sounds[t][this.Sounds[t].index].addEventListener("ended",this.LoopCallback,!1),this.Sounds[t][this.Sounds[t].index++].play(),this.Sounds[t].index},PauseChannel:function(t,e){return this.Sounds[t][e].paused||this.Sounds[t][e].pause(),this},PauseSound:function(t){for(var e=0;e<this.Sounds[t].length;e++)this.Sounds[t][e].paused||this.Sounds[t][e].pause();return this},ResetChannel:function(t,e){return this.Sounds[t][e].currentTime=0,this.StopLoop(t,e),this},ResetSound:function(t){for(var e=0;e<this.Sounds[t].length;e++)this.Sounds[t].currentTime=0,this.StopLoop(t,e);return this},StopLoop:function(t,e){this.Sounds[t][e].removeEventListener("ended",this.LoopCallback,!1)},LoopCallback:function(){this.currentTime=-1,this.play()}},m.Drawable=function(){this.ZOrder=0},m.Drawable.prototype={Draw:function(t){}},m.GameStateContext=function(t){this.State=null,null!=t&&(this.State=t,this.State.Enter())},m.GameStateContext.prototype={ChangeState:function(t){null!=this.State&&this.State.Exit(),this.State=t,this.State.Enter()},Update:function(t){this.State.CheckForChange(this),this.State.Update(t)},Draw:function(t){this.State.Draw(t)}},m.GameState=function(){},m.GameState.prototype={Enter:function(){},Exit:function(){},Update:function(t){},Draw:function(t){},CheckForChange:function(t){}},m.GameTimer=function(){this.FramesPerSecond=1e3/30,this.LastTime=0,this.IntervalFunc=null,this.UpdateObject=null,this.isPaused=!1},m.GameTimer.prototype={Start:function(){this.LastTime=(new Date).getTime();var t=this;this.IntervalFunc=setInterval((function(){this.isPaused||t.Tick()}),this.FramesPerSecond)},Tick:function(){if(null!=this.UpdateObject){var t=(new Date).getTime(),e=(t-this.LastTime)/1e3;this.LastTime=t,this.UpdateObject.Update(e)}},Stop:function(){clearInterval(this.IntervalFunc)},Pause:function(){this.isPaused=!this.isPaused}},m.Camera=function(){this.X=0,this.Y=0},m.DrawableManager=function(){this.Unsorted=!0,this.Objects=[]},m.DrawableManager.prototype={Add:function(t){this.Objects.push(t),this.Unsorted=!0},AddRange:function(t){this.Objects=this.Objects.concat(t),this.Unsorted=!0},Clear:function(){this.Objects.splice(0,this.Objects.length)},Contains:function(t){for(var e=this.Objects.length;e--;)if(this.Objects[e]===t)return!0;return!1},Remove:function(t){var e=this.Objects.indexOf(t);this.Objects.splice(e,1)},RemoveAt:function(t){this.Objects.splice(t,1)},RemoveRange:function(t,e){this.Objects.splice(t,e)},RemoveList:function(t){var e=0,i=0;for(i=0;i<t.length;e++)for(e=0;e<this.Objects.length;e++)if(this.Objects[e]===t[i]){this.Objects.splice(e,1),t.splice(i,1),i--;break}},Update:function(t){var e=0;for(e=0;e<this.Objects.length;e++)this.Objects[e].Update&&this.Objects[e].Update(t)},Draw:function(t,e){this.Unsorted&&(this.Unsorted=!1,this.Objects.sort((function(t,e){return t.ZOrder-e.ZOrder})));var i=0;for(i=0;i<this.Objects.length;i++)this.Objects[i].Draw&&this.Objects[i].Draw(t,e)}},m.Sprite=function(){this.X=0,this.Y=0,this.Image=null},m.Sprite.prototype=new m.Drawable,m.Sprite.prototype.Draw=function(t,e){t.drawImage(this.Image,this.X-e.X,this.Y-e.Y)},m.SpriteFont=function(t,e,i,s,h){this.Image=e,this.Letters=h,this.LetterWidth=i,this.LetterHeight=s,this.Strings=t},m.SpriteFont.prototype=new m.Drawable,m.SpriteFont.prototype.Draw=function(t,e){for(var i=0;i<this.Strings.length;i++)for(var s=this.Strings[i],h=0;h<s.String.length;h++){var a=s.String.charCodeAt(h);t.drawImage(this.Image,this.Letters[a].X,this.Letters[a].Y,this.LetterWidth,this.LetterHeight,s.X+this.LetterWidth*(h+1),s.Y,this.LetterWidth,this.LetterHeight)}},m.FrameSprite=function(){this.FrameX=0,this.FrameY=0,this.FrameWidth=0,this.FrameHeight=0},m.FrameSprite.prototype=new m.Sprite,m.FrameSprite.prototype.Draw=function(t,e){t.drawImage(this.Image,this.FrameX,this.FrameY,this.FrameWidth,this.FrameHeight,this.X-e.X,this.Y-e.Y,this.FrameWidth,this.FrameHeight)},m.AnimationSequence=function(t,e,i,s){this.StartRow=t,this.StartColumn=e,this.EndRow=i,this.EndColumn=s,this.SingleFrame=!1,this.StartRow==this.EndRow&&this.StartColumn==this.EndColumn&&(this.SingleFrame=!0)},m.AnimatedSprite=function(){this.LastElapsed=0,this.FramesPerSecond=.05,this.CurrentSequence=null,this.Playing=!1,this.Looping=!1,this.Rows=0,this.Columns=0,this.Sequences=new Object},m.AnimatedSprite.prototype=new m.FrameSprite,m.AnimatedSprite.prototype.Update=function(t){if(!this.CurrentSequence.SingleFrame&&this.Playing&&(this.LastElapsed-=t,!(this.LastElapsed>0))){this.LastElapsed=this.FramesPerSecond,this.FrameX+=this.FrameWidth,this.FrameX>this.Image.width-this.FrameWidth&&(this.FrameX=0,this.FrameY+=this.FrameHeight,this.FrameY>this.Image.height-this.FrameHeight&&(this.FrameY=0));var e=!1;this.FrameX>this.CurrentSequence.EndColumn*this.FrameWidth&&this.FrameY==this.CurrentSequence.EndRow*this.FrameHeight?e=!0:0==this.FrameX&&this.FrameY>this.CurrentSequence.EndRow*this.FrameHeight&&(e=!0),e&&(this.Looping?(this.FrameX=this.CurrentSequence.StartColumn*this.FrameWidth,this.FrameY=this.CurrentSequence.StartRow*this.FrameHeight):this.Playing=!1)}},m.AnimatedSprite.prototype.PlaySequence=function(t,e){this.Playing=!0,this.Looping=e,this.CurrentSequence=this.Sequences["seq_"+t],this.FrameX=this.CurrentSequence.StartColumn*this.FrameWidth,this.FrameY=this.CurrentSequence.StartRow*this.FrameHeight},m.AnimatedSprite.prototype.StopLooping=function(){this.Looping=!1},m.AnimatedSprite.prototype.StopPlaying=function(){this.Playing=!1},m.AnimatedSprite.prototype.SetFrameWidth=function(t){this.FrameWidth=t,this.Rows=this.Image.width/this.FrameWidth},m.AnimatedSprite.prototype.SetFrameHeight=function(t){this.FrameHeight=t,this.Columns=this.Image.height/this.FrameHeight},m.AnimatedSprite.prototype.SetColumnCount=function(t){this.FrameWidth=this.Image.width/t,this.Columns=t},m.AnimatedSprite.prototype.SetRowCount=function(t){this.FrameHeight=this.Image.height/t,this.Rows=t},m.AnimatedSprite.prototype.AddExistingSequence=function(t,e){this.Sequences["seq_"+t]=e},m.AnimatedSprite.prototype.AddNewSequence=function(t,e,i,s,h){this.Sequences["seq_"+t]=new m.AnimationSequence(e,i,s,h)},m.AnimatedSprite.prototype.DeleteSequence=function(t){null!=this.Sequences["seq_"+t]&&delete this.Sequences["seq_"+t]},m.AnimatedSprite.prototype.ClearSequences=function(){delete this.Sequences,this.Sequences=new Object},m.Collideable=function(t,e,i,s){this.Base=t,this.X=t.X,this.Y=t.Y,this.Width=e,this.Height=i,this.CollisionEvent=null!=s?s:function(){}},m.Collideable.prototype={Update:function(){this.X=this.Base.X,this.Y=this.Base.Y},CheckCollision:function(t){var e=this.X,i=t.X,s=this.X+this.Width,h=t.X+t.Width,a=this.Y,r=t.Y,n=this.Y+this.Height,o=t.Y+t.Height;n<r||a>o||s<i||e>h||(this.CollisionEvent(t),t.CollisionEvent(this))}},m.Application=function(t){this.canvas=null,this.timer=null,this.stateContext=null,this.mobile=!1,t&&(this.mobile=!0)},m.Application.prototype={Update:function(t){this.stateContext.Update(t),this.canvas.BeginDraw(),this.stateContext.Draw(this.canvas.BackBufferContext2D),this.canvas.EndDraw()},Initialize:function(t,e,i){return this.canvas=new m.GameCanvas,this.timer=new m.GameTimer,m.KeyboardInput.Initialize(this.mobile),this.canvas.Initialize("canvas",e,i),this.timer.UpdateObject=this,t.mobile=this.mobile,this.stateContext=new m.GameStateContext(t),this.timer.Start(),this}},g.SpriteCuts={CreateBlackFont:function(){return new m.SpriteFont([],m.Resources.Images.font,8,8,this.GetCharArray(0))},CreateRedFont:function(){return new m.SpriteFont([],m.Resources.Images.font,8,8,this.GetCharArray(8))},CreateGreenFont:function(){return new m.SpriteFont([],m.Resources.Images.font,8,8,this.GetCharArray(16))},CreateBlueFont:function(){return new m.SpriteFont([],m.Resources.Images.font,8,8,this.GetCharArray(24))},CreateYellowFont:function(){return new m.SpriteFont([],m.Resources.Images.font,8,8,this.GetCharArray(32))},CreatePinkFont:function(){return new m.SpriteFont([],m.Resources.Images.font,8,8,this.GetCharArray(40))},CreateCyanFont:function(){return new m.SpriteFont([],m.Resources.Images.font,8,8,this.GetCharArray(48))},CreateWhiteFont:function(){return new m.SpriteFont([],m.Resources.Images.font,8,8,this.GetCharArray(56))},GetCharArray:function(t){var e=[],i=0;for(i=32;i<127;i++)e[i]={X:8*(i-32),Y:t};return e},GetBackgroundSheet:function(){var t=[],e=0,i=0,s=m.Resources.Images.background.width/32,h=m.Resources.Images.background.height/32;for(e=0;e<s;e++)for(t[e]=[],i=0;i<h;i++)t[e][i]={X:32*e,Y:32*i,Width:32,Height:32};return t},GetLevelSheet:function(){var t=[],e=0,i=0,s=m.Resources.Images.map.width/16,h=m.Resources.Images.map.height/16;for(e=0;e<s;e++)for(t[e]=[],i=0;i<h;i++)t[e][i]={X:16*e,Y:16*i,Width:16,Height:16};return t}},g.Tile={BlockUpper:1,BlockAll:2,BlockLower:4,Special:8,Bumpable:16,Breakable:32,PickUpable:64,Animated:128,Behaviors:[],LoadBehaviors:function(){var t=[];t[0]=0,t[1]=20,t[2]=28,t[3]=0,t[4]=130,t[5]=130,t[6]=130,t[7]=130,t[8]=2,t[9]=2,t[10]=2,t[11]=2,t[12]=2,t[13]=0,t[14]=138,t[15]=0,t[16]=162,t[17]=146,t[18]=154,t[19]=162,t[20]=146,t[21]=146,t[22]=154,t[23]=146,t[24]=2,t[25]=0,t[26]=2,t[27]=2,t[28]=2,t[29]=0,t[30]=2,t[31]=0,t[32]=192,t[33]=192,t[34]=192,t[35]=192,t[36]=0,t[37]=0,t[38]=0,t[39]=0,t[40]=2,t[41]=2,t[42]=0,t[43]=0,t[44]=0,t[45]=0,t[46]=2,t[47]=0,t[48]=0,t[49]=0,t[50]=0,t[51]=0,t[52]=0,t[53]=0,t[54]=0,t[55]=0,t[56]=2,t[57]=2;var e=0;for(e=58;e<128;e++)t[e]=0;for(t[128]=2,t[129]=2,t[130]=2,t[131]=0,t[132]=1,t[133]=1,t[134]=1,t[135]=0,t[136]=2,t[137]=2,t[138]=2,t[139]=0,t[140]=2,t[141]=2,t[142]=2,t[143]=0,t[144]=2,t[145]=0,t[146]=2,t[147]=0,t[148]=0,t[149]=0,t[150]=0,t[151]=0,t[152]=2,t[153]=2,t[154]=2,t[155]=0,t[156]=2,t[157]=2,t[158]=2,t[159]=0,t[160]=2,t[161]=2,t[162]=2,t[163]=0,t[164]=0,t[165]=0,t[166]=0,t[167]=0,t[168]=2,t[169]=2,t[170]=2,t[171]=0,t[172]=2,t[173]=2,t[174]=2,t[175]=0,t[176]=2,t[177]=2,t[178]=2,t[179]=0,t[180]=1,t[181]=1,t[182]=1,e=183;e<224;e++)t[e]=0;for(t[224]=1,t[225]=1,t[226]=1,e=227;e<256;e++)t[e]=0;this.Behaviors=t}},g.LevelType={Overground:0,Underground:1,Castle:2},g.Odds={Straight:0,HillStraight:1,Tubes:2,Jump:3,Cannons:4},g.Level=function(t,e){this.Width=t,this.Height=e,this.ExitX=10,this.ExitY=10,this.Map=[],this.Data=[],this.SpriteTemplates=[];var i=0,s=0;for(i=0;i<this.Width;i++)for(this.Map[i]=[],this.Data[i]=[],this.SpriteTemplates[i]=[],s=0;s<this.Height;s++)this.Map[i][s]=0,this.Data[i][s]=0,this.SpriteTemplates[i][s]=null},g.Level.prototype={Update:function(){var t=0,e=0;for(t=0;t<this.Width;t++)for(e=0;e<this.Height;e++)this.Data[t][e]>0&&this.Data[t][e]--},GetBlockCapped:function(t,e){return t<0&&(t=0),e<0&&(e=0),t>=this.Width&&(t=this.Width-1),e>=this.Height&&(e=this.Height-1),this.Map[t][e]},GetBlock:function(t,e){return t<0&&(t=0),e<0?0:(t>=this.Width&&(t=this.Width-1),e>=this.Height&&(e=this.Height-1),this.Map[t][e])},SetBlock:function(t,e,i){t<0||e<0||t>=this.Width||e>=this.Height||(this.Map[t][e]=i)},SetBlockData:function(t,e,i){t<0||e<0||t>=this.Width||e>=this.Height||(this.Data[t][e]=i)},IsBlocking:function(t,e,i,s){var h=this.GetBlock(t,e),a=(g.Tile.Behaviors[255&h]&g.Tile.BlockAll)>0;return a|=s>0&&(g.Tile.Behaviors[255&h]&g.Tile.BlockUpper)>0,a|=s<0&&(g.Tile.Behaviors[255&h]&g.Tile.BlockLower)>0},GetSpriteTemplate:function(t,e){return t<0?null:e<0?null:t>=this.Width?null:e>=this.Height?null:this.SpriteTemplates[t][e]},SetSpriteTemplate:function(t,e,i){t<0||e<0||t>=this.Width||e>=this.Height||(this.SpriteTemplates[t][e]=i)}},g.BackgroundGenerator=function(t,e,i,s){this.Width=t,this.Height=e,this.Distant=i,this.Type=s},g.BackgroundGenerator.prototype={SetValues:function(t,e,i,s){this.Width=t,this.Height=e,this.Distant=i,this.Type=s},CreateLevel:function(){var t=new g.Level(this.Width,this.Height);switch(this.Type){case g.LevelType.Overground:this.GenerateOverground(t);break;case g.LevelType.Underground:this.GenerateUnderground(t);break;case g.LevelType.Castle:this.GenerateCastle(t)}return t},GenerateOverground:function(t){var e=this.Distant?4:6,i=this.Distant?2:1,s=Math.floor(Math.random()*e)+i,h=Math.floor(Math.random()*e)+i,a=0,r=0,n=0,o=0,l=2;for(a=0;a<this.Width;a++){for(s=h;s===h;)h=Math.floor(Math.random()*e)+i;for(r=0;r<this.Height;r++)o=s<h?h:s,l=2,r<(n=s<h?s:h)?this.Distant?(l=2,r<2&&(l=r),t.SetBlock(a,r,4+8*l)):t.SetBlock(a,r,5):r===n?(l=n===h?0:1,l+=this.Distant?2:0,t.SetBlock(a,r,l)):r===o?(l=n===h?0:1,l+=this.Distant?2:0,t.SetBlock(a,r,l+16)):(l=r>o?1:0,n===s&&(l=1-l),l+=this.Distant?2:0,t.SetBlock(a,r,l+8))}},GenerateUnderground:function(t){var e=0,i=0,s=0,h=0;if(this.Distant){var a=0;for(e=0;e<this.Width;e++)for(Math.random()<.75&&(a=1-a),i=0;i<this.Height;i++)s=a,((h=i-2)<0||h>4)&&(h=2,s=0),t.SetBlock(e,i,4+s+8*(3+h))}else for(e=0;e<this.Width;e++)for(i=0;i<this.Height;i++)s=e%2,((h=i-1)<0||h>7)&&(h=7,s=0),0===s&&h>1&&h<5&&(s=-1,h=0),t.SetBlock(e,i,6+s+8*h)},GenerateCastle:function(t){var e=0,i=0,s=0,h=0;if(this.Distant)for(e=0;e<this.Width;e++)for(i=0;i<this.Height;i++)s=e%2,(h=i-1)>2&&h<5?h=2:h>=5&&(h-=2),h<0?(s=0,h=5):h>4?(s=1,h=5):s<1&&3===h?(s=0,h=3):s<1&&h>0&&h<3&&(s=0,h=2),t.SetBlock(e,i,1+s+8*(h+4));else for(e=0;e<this.Width;e++)for(i=0;i<this.Height;i++)s=e%3,(h=i-1)>2&&h<5?h=2:h>=5&&(h-=2),h<0?(s=1,h=5):h>4?(s=2,h=5):s<2&&4===h?(s=2,h=4):s<2&&h>0&&h<4&&(s=4,h=-3),t.SetBlock(e,i,1+s+8*(h+3))}},g.BackgroundRenderer=function(t,e,i,s){this.Level=t,this.Width=e,this.Distance=s,this.TilesY=1+(i/32|0),this.Background=g.SpriteCuts.GetBackgroundSheet()},g.BackgroundRenderer.prototype=new m.Drawable,g.BackgroundRenderer.prototype.Draw=function(t,e){var i=e.X/this.Distance,s=0,h=0,a=null,r=null,n=i/32|0,o=(i+this.Width)/32|0;for(s=n;s<=o;s++)for(h=0;h<this.TilesY;h++)a=255&this.Level.GetBlock(s,h),r=this.Background[a%8][a/8|0],t.drawImage(m.Resources.Images.background,r.X,r.Y,r.Width,r.Height,(s<<5)-i|0,h<<5|0,r.Width,r.Height)},g.ImprovedNoise=function(t){this.P=[],this.Shuffle(t)},g.ImprovedNoise.prototype={Shuffle:function(t){var e=[],i=0,s=0,h=0;for(i=0;i<256;i++)e[i]=i;for(i=0;i<256;i++)s=(255*Math.random()|0)+i,h=e[i],e[i]=e[s],e[s]=h,this.P[i+256]=this.P[i]=e[i]},PerlinNoise:function(t,e){var i=0,s=0,h=0;for(i=0;i<8;i++)h=64/(1<<i),s+=this.Noise(t/h,e/h,128)/(1<<i);return s},Noise:function(t,e,i){var s=255&(0|t),h=255&(0|e),a=255&(0|i);t-=0|t,e-=0|e,i-=0|i;var r=this.Fade(t),n=this.Fade(e),o=this.Fade(i),l=this.P[s]+h,c=this.P[l]+a,d=this.P[l+1]+a,u=this.P[s+1]+h,p=this.P[u]+a,m=this.P[u+1]+a;return this.Lerp(o,this.Lerp(n,this.Lerp(r,this.Grad(this.P[c],t,e,i),this.Grad(this.P[p],t-1,e,i)),this.Lerp(r,this.Grad(this.P[d],t,e-1,i),this.Grad(this.P[m],t-1,e-1,i))),this.Lerp(n,this.Lerp(r,this.Grad(this.P[c+1],t,e,i-1),this.Grad(this.P[p+1],t-1,e,i-1)),this.Lerp(r,this.Grad(this.P[d+1],t,e-1,i-1),this.Grad(this.P[m+1],t-1,e-1,i-1))))},Fade:function(t){return t*t*t*(t*(6*t-15)+10)},Lerp:function(t,e,i){return e+t*(i-e)},Grad:function(t,e,i,s){var h=15&t,a=h<8?e:i,r=h<4?i:12===h||14===h?e:s;return(0===(1&h)?a:-a)+(0===(2&h)?r:-r)}},g.NotchSprite=function(t){this.XOld=0,this.YOld=0,this.X=0,this.Y=0,this.Xa=0,this.Ya=0,this.XPic=0,this.YPic=0,this.XPicO=0,this.YPicO=0,this.PicWidth=32,this.PicHeight=32,this.XFlip=!1,this.YFlip=!1,this.Visible=!0,this.Image=t,this.Delta=0,this.SpriteTemplate=null,this.Layer=1},g.NotchSprite.prototype=new m.Drawable,g.NotchSprite.prototype.Draw=function(t,e){var i,s;this.Visible&&(i=(this.XOld+(this.X-this.XOld)*this.Delta|0)-this.XPicO,s=(this.YOld+(this.Y-this.YOld)*this.Delta|0)-this.YPicO,t.save(),t.scale(this.XFlip?-1:1,this.YFlip?-1:1),t.translate(this.XFlip?-320:0,this.YFlip?-240:0),t.drawImage(this.Image,this.XPic*this.PicWidth,this.YPic*this.PicHeight,this.PicWidth,this.PicHeight,this.XFlip?320-i-this.PicWidth:i,this.YFlip?240-s-this.PicHeight:s,this.PicWidth,this.PicHeight),t.restore())},g.NotchSprite.prototype.Update=function(t){this.XOld=this.X,this.YOld=this.Y,this.Move(),this.Delta=t},g.NotchSprite.prototype.UpdateNoMove=function(t){this.XOld=this.X,this.YOld=this.Y,this.Delta=0},g.NotchSprite.prototype.Move=function(){this.X+=this.Xa,this.Y+=this.Ya},g.NotchSprite.prototype.GetX=function(t){return(this.XOld+(this.X-this.XOld)*t|0)-this.XPicO},g.NotchSprite.prototype.GetY=function(t){return(this.YOld+(this.Y-this.YOld)*t|0)-this.YPicO},g.NotchSprite.prototype.CollideCheck=function(){},g.NotchSprite.prototype.BumpCheck=function(t,e){},g.NotchSprite.prototype.Release=function(t){},g.NotchSprite.prototype.ShellCollideCheck=function(t){return!1},g.NotchSprite.prototype.FireballCollideCheck=function(t){return!1},g.Character=function(){this.Large=!0,this.Fire=!0,this.Coins=0,this.Lives=3,this.LevelString="none",this.GroundInertia=.89,this.AirInertia=.89,this.RunTime=0,this.WasOnGround=!1,this.OnGround=!1,this.MayJump=!1,this.Ducking=!1,this.Sliding=!1,this.JumpTime=0,this.XJumpSpeed=0,this.YJumpSpeed=0,this.CanShoot=!1,this.Width=4,this.Height=24,this.World=null,this.Facing=0,this.PowerUpTime=0,this.XDeathPos=0,this.YDeathPos=0,this.DeathTime=0,this.WinTime=0,this.InvulnerableTime=0,this.Carried=null,this.LastLarge=!1,this.LastFire=!1,this.NewLarge=!1,this.NewFire=!1},g.Character.prototype=new g.NotchSprite(null),g.Character.prototype.Initialize=function(t){this.World=t,this.X=32,this.Y=0,this.PowerUpTime=0,this.RunTime=0,this.WasOnGround=!1,this.OnGround=!1,this.MayJump=!1,this.Ducking=!1,this.Sliding=!1,this.JumpTime=0,this.XJumpSpeed=0,this.YJumpSpeed=0,this.CanShoot=!1,this.Width=4,this.Height=24,this.World=t,this.Facing=0,this.PowerUpTime=0,this.XDeathPos=0,this.YDeathPos=0,this.DeathTime=0,this.WinTime=0,this.InvulnerableTime=0,this.Carried=null,this.SetLarge(this.Large,this.Fire)},g.Character.prototype.SetLarge=function(t,e){e&&(t=!0),t||(e=!1),this.LastLarge=this.Large,this.LastFire=this.Fire,this.Large=t,this.Fire=e,this.NewLarge=this.Large,this.NewFire=this.Fire,this.Blink(!0)},g.Character.prototype.Blink=function(t){this.Large=t?this.NewLarge:this.LastLarge,this.Fire=t?this.NewFire:this.LastFire,this.Large?(this.Fire?this.Image=m.Resources.Images.fireMario:this.Image=m.Resources.Images.mario,this.XPicO=16,this.YPicO=31,this.PicWidth=this.PicHeight=32):(this.Image=m.Resources.Images.smallMario,this.XPicO=8,this.YPicO=15,this.PicWidth=this.PicHeight=16)},g.Character.prototype.Move=function(){if(this.WinTime>0)return this.WinTime++,this.Xa=0,void(this.Ya=0);if(this.DeathTime>0)return this.DeathTime++,this.DeathTime<11?(this.Xa=0,this.Ya=0):11===this.DeathTime?this.Ya=-15:this.Ya+=2,this.X+=this.Xa,void(this.Y+=this.Ya);if(0!==this.PowerUpTime)return this.PowerUpTime>0?(this.PowerUpTime--,this.Blink(0===(1&(this.PowerUpTime/3|0)))):(this.PowerUpTime++,this.Blink(0===(1&(-this.PowerUpTime/3|0)))),0===this.PowerUpTime&&(this.World.Paused=!1),void this.CalcPic();this.InvulnerableTime>0&&this.InvulnerableTime--,this.Visible=0===(1&(this.InvulerableTime/2|0)),this.WasOnGround=this.OnGround;var t=m.KeyboardInput.IsKeyDown(m.Keys.A)?1.2:.6;this.OnGround&&(m.KeyboardInput.IsKeyDown(m.Keys.Down)&&this.Large?this.Ducking=!0:this.Ducking=!1),this.Xa>2&&(this.Facing=1),this.Xa<-2&&(this.Facing=-1),m.KeyboardInput.IsKeyDown(m.Keys.S)||this.JumpTime<0&&!this.OnGround&&!this.Sliding?this.JumpTime<0?(this.Xa=this.XJumpSpeed,this.Ya=-this.JumpTime*this.YJumpSpeed,this.JumpTime++):this.OnGround&&this.MayJump?(m.Resources.PlaySound("jump"),this.XJumpSpeed=0,this.YJumpSpeed=-1.9,this.JumpTime=7,this.Ya=this.JumpTime*this.YJumpSpeed,this.OnGround=!1,this.Sliding=!1):this.Sliding&&this.MayJump?(m.Resources.PlaySound("jump"),this.XJumpSpeed=6*-this.Facing,this.YJumpSpeed=-2,this.JumpTime=-6,this.Xa=this.XJumpSpeed,this.Ya=-this.JumpTime*this.YJumpSpeed,this.OnGround=!1,this.Sliding=!1,this.Facing=-this.Facing):this.JumpTime>0&&(this.Xa+=this.XJumpSpeed,this.Ya=this.JumpTime*this.YJumpSpeed,this.JumpTime--):this.JumpTime=0,m.KeyboardInput.IsKeyDown(m.Keys.Left)&&!this.Ducking&&(1===this.Facing&&(this.Sliding=!1),this.Xa-=t,this.JumpTime>=0&&(this.Facing=-1)),m.KeyboardInput.IsKeyDown(m.Keys.Right)&&!this.Ducking&&(-1===this.Facing&&(this.Sliding=!1),this.Xa+=t,this.JumpTime>=0&&(this.Facing=1)),(!m.KeyboardInput.IsKeyDown(m.Keys.Left)&&!m.KeyboardInput.IsKeyDown(m.Keys.Right)||this.Ducking||this.Ya<0||this.OnGround)&&(this.Sliding=!1),m.KeyboardInput.IsKeyDown(m.Keys.A)&&this.CanShoot&&this.Fire&&this.World.FireballsOnScreen<2&&(m.Resources.PlaySound("fireball"),this.World.AddSprite(new g.Fireball(this.World,this.X+6*this.Facing,this.Y-20,this.Facing))),this.CanShoot=!m.KeyboardInput.IsKeyDown(m.Keys.A),this.MayJump=(this.OnGround||this.Sliding)&&!m.KeyboardInput.IsKeyDown(m.Keys.S),this.XFlip=-1===this.Facing,this.RunTime+=Math.abs(this.Xa)+5,Math.abs(this.Xa)<.5&&(this.RunTime=0,this.Xa=0),this.CalcPic(),this.Sliding&&(this.World.AddSprite(new g.Sparkle(this.World,(this.X+4*Math.random()-2|0)+8*this.Facing,(this.Y+4*Math.random()|0)-24,2*Math.random()-1,Math.random(),0,1,5)),this.Ya*=.5),this.OnGround=!1,this.SubMove(this.Xa,0),this.SubMove(0,this.Ya),this.Y>16*this.World.Level.Height+16&&this.Die(),this.X<0&&(this.X=0,this.Xa=0),this.X>16*this.World.Level.ExitX&&this.Win(),this.X>16*this.World.Level.Width&&(this.X=16*this.World.Level.Width,this.Xa=0),this.Ya*=.85,this.OnGround?this.Xa*=this.GroundInertia:this.Xa*=this.AirInertia,this.OnGround||(this.Ya+=3),null!==this.Carried&&(this.Carried.X*=this.X+8*this.Facing,this.Carried.Y*=this.Y-2,m.KeyboardInput.IsKeyDown(m.Keys.A)||(this.Carried.Release(this),this.Carried=null))},g.Character.prototype.CalcPic=function(){var t=0,e=0;if(this.Large?(3===(t=(this.RunTime/20|0)%4)&&(t=1),null===this.Carried&&Math.abs(this.Xa)>10&&(t+=3),null!==this.Carried&&(t+=10),this.OnGround||(t=null!==this.Carried?12:Math.abs(this.Xa)>10?7:6)):(t=(this.RunTime/20|0)%2,null===this.Carried&&Math.abs(this.Xa)>10&&(t+=2),null!==this.Carried&&(t+=8),this.OnGround||(t=null!==this.Carried?9:Math.abs(this.Xa)>10?5:4)),this.OnGround&&(-1===this.Facing&&this.Xa>0||1===this.Facing&&this.Xa<0)&&((this.Xa>1||this.Xa<-1)&&(t=this.Large?9:7),this.Xa>3||this.Xa<-3))for(e=0;e<3;e++)this.World.AddSprite(new g.Sparkle(this.World,this.X+8*Math.random()-4|0,this.Y+4*Math.random()|0,2*Math.random()-1,-1*Math.random(),0,1,5));this.Large?(this.Ducking&&(t=14),this.Height=this.Ducking?12:24):this.Height=12,this.XPic=t},g.Character.prototype.SubMove=function(t,e){for(var i=!1;t>8;){if(!this.SubMove(8,0))return!1;t-=8}for(;t<-8;){if(!this.SubMove(-8,0))return!1;t+=8}for(;e>8;){if(!this.SubMove(0,8))return!1;e-=8}for(;e<-8;){if(!this.SubMove(0,-8))return!1;e+=8}return e>0&&(this.IsBlocking(this.X+t-this.Width,this.Y+e,t,0)?i=!0:this.IsBlocking(this.X+t+this.Width,this.Y+e,t,0)?i=!0:this.IsBlocking(this.X+t-this.Width,this.Y+e+1,t,e)?i=!0:this.IsBlocking(this.X+t+this.Width,this.Y+e+1,t,e)&&(i=!0)),e<0&&(this.IsBlocking(this.X+t,this.Y+e-this.Height,t,e)?i=!0:i||this.IsBlocking(this.X+t-this.Width,this.Y+e-this.Height,t,e)?i=!0:(i||this.IsBlocking(this.X+t+this.Width,this.Y+e-this.Height,t,e))&&(i=!0)),t>0&&(this.Sliding=!0,this.IsBlocking(this.X+t+this.Width,this.Y+e-this.Height,t,e)?i=!0:this.Sliding=!1,this.IsBlocking(this.X+t+this.Width,this.Y+e-(this.Height/2|0),t,e)?i=!0:this.Sliding=!1,this.IsBlocking(this.X+t+this.Width,this.Y+e,t,e)?i=!0:this.Sliding=!1),t<0&&(this.Sliding=!0,this.IsBlocking(this.X+t-this.Width,this.Y+e-this.Height,t,e)?i=!0:this.Sliding=!1,this.IsBlocking(this.X+t-this.Width,this.Y+e-(this.Height/2|0),t,e)?i=!0:this.Sliding=!1,this.IsBlocking(this.X+t-this.Width,this.Y+e,t,e)?i=!0:this.Sliding=!1),i?(t<0&&(this.X=16*((this.X-this.Width)/16|0)+this.Width,this.Xa=0),t>0&&(this.X=16*((this.X+this.Width)/16+1|0)-this.Width-1,this.Xa=0),e<0&&(this.Y=16*((this.Y-this.Height)/16|0)+this.Height,this.JumpTime=0,this.Ya=0),e>0&&(this.Y=16*((this.Y-1)/16+1|0)-1,this.OnGround=!0),!1):(this.X+=t,this.Y+=e,!0)},g.Character.prototype.IsBlocking=function(t,e,i,s){var h,a,r=0,n=0;if(e=e/16|0,(t=t/16|0)===(this.X/16|0)&&e===(this.Y/16|0))return!1;if(a=this.World.Level.GetBlock(t,e),(g.Tile.Behaviors[255&a]&g.Tile.PickUpable)>0)for(this.GetCoin(),m.Resources.PlaySound("coin"),this.World.Level.SetBlock(t,e,0),r=0;r<2;r++)for(n=0;n<2;n++)this.World.AddSprite(new g.Sparkle(this.World,16*t+8*r+(8*Math.random()|0),16*e+8*n+(8*Math.random()|0),0,0,0,2,5));return(h=this.World.Level.IsBlocking(t,e,i,s))&&s<0&&this.World.Bump(t,e,this.Large),h},g.Character.prototype.Stomp=function(t){var e;this.DeathTime>0||this.World.Paused||(e=t.Y-t.Height/2,this.SubMove(0,e-this.Y),t instanceof g.Enemy||t instanceof g.BulletBill?(m.Resources.PlaySound("kick"),this.XJumpSpeed=0,this.YJumpSpeed=-1.9,this.JumpTime=8,this.Ya=this.JumpTime*this.YJumpSpeed,this.OnGround=!1,this.Sliding=!1,this.InvulnerableTime=1):t instanceof g.Shell&&(m.KeyboardInput.IsKeyDown(m.Keys.A)&&0===t.Facing?(this.Carried=t,t.Carried=!0):(m.Resources.PlaySound("kick"),this.XJumpSpeed=0,this.YJumpSpeed=-1.9,this.JumpTime=8,this.Ya=this.JumpTime*this.YJumpSpeed,this.OnGround=!1,this.Sliding=!1,this.InvulnerableTime=1)))},g.Character.prototype.GetHurt=function(){this.DeathTime>0||this.World.Paused||this.InvulnerableTime>0||(this.Large?(this.World.Paused=!0,this.PowerUpTime=-18,m.Resources.PlaySound("powerdown"),this.Fire?this.SetLarge(!0,!1):this.SetLarge(!1,!1),this.InvulnerableTime=32):this.Die())},g.Character.prototype.Win=function(){this.XDeathPos=0|this.X,this.YDeathPos=0|this.Y,this.World.Paused=!0,this.WinTime=1,m.Resources.PlaySound("exit")},g.Character.prototype.Die=function(){this.XDeathPos=0|this.X,this.YDeathPos=0|this.Y,this.World.Paused=!0,this.DeathTime=1,m.Resources.PlaySound("death"),this.SetLarge(!1,!1)},g.Character.prototype.GetFlower=function(){this.DeathTime>0&&this.World.Paused||(this.Fire?(this.GetCoin(),m.Resources.PlaySound("coin")):(this.World.Paused=!0,this.PowerUpTime=18,m.Resources.PlaySound("powerup"),this.SetLarge(!0,!0)))},g.Character.prototype.GetMushroom=function(){this.DeathTime>0&&this.World.Paused||(this.Large?(this.GetCoin(),m.Resources.PlaySound("coin")):(this.World.Paused=!0,this.PowerUpTime=18,m.Resources.PlaySound("powerup"),this.SetLarge(!0,!1)))},g.Character.prototype.Kick=function(t){this.DeathTime>0&&this.World.Paused||(m.KeyboardInput.IsKeyDown(m.Keys.A)?(this.Carried=t,t.Carried=!0):(m.Resources.PlaySound("kick"),this.InvulnerableTime=1))},g.Character.prototype.Get1Up=function(){m.Resources.PlaySound("1up"),this.Lives++,99===this.Lives&&(this.Lives=99)},g.Character.prototype.GetCoin=function(){this.Coins++,100===this.Coins&&(this.Coins=0,this.Get1Up())},g.LevelRenderer=function(t,e,i){this.Width=e,this.Height=i,this.Level=t,this.TilesY=1+(i/16|0),this.Delta=0,this.Tick=0,this.Bounce=0,this.AnimTime=0,this.Background=g.SpriteCuts.GetLevelSheet()},g.LevelRenderer.prototype=new m.Drawable,g.LevelRenderer.prototype.Update=function(t){this.AnimTime+=t,this.Tick=0|this.AnimTime,this.Bounce+=30*t,this.Delta=t},g.LevelRenderer.prototype.Draw=function(t,e){this.DrawStatic(t,e),this.DrawDynamic(t,e)},g.LevelRenderer.prototype.DrawStatic=function(t,e){var i=0,s=0,h=0,a=null,r=e.X/16|0,n=(e.X+this.Width)/16|0;for(i=r;i<n+1;i++)for(s=0;s<this.TilesY;s++)h=255&this.Level.GetBlock(i,s),0===(g.Tile.Behaviors[h]&g.Tile.Animated)&&(a=this.Background[h%16][h/16|0],t.drawImage(m.Resources.Images.map,a.X,a.Y,a.Width,a.Height,(i<<4)-e.X|0,s<<4|0,a.Width,a.Height))},g.LevelRenderer.prototype.DrawDynamic=function(t,e){var i=0,s=0,h=0,a=0,r=0,n=null;for(i=e.X/16|0;i<=(e.X+this.Width)/16|0;i++)for(s=e.Y/16|0;s<=(e.Y+this.Height)/16|0;s++)h=this.Level.GetBlock(i,s),(g.Tile.Behaviors[255&h]&g.Tile.Animated)>0&&(a=(this.Bounce/3|0)%4,0===(h%16/4|0)&&1===(h/16|0)&&(a=(this.Bounce/2+(i+s)/8|0)%20)>3&&(a=0),3===(h%16/4|0)&&0===(h/16|0)&&(a=2),r=0,i>=0&&s>=0&&i<this.Level.Width&&s<this.Level.Height&&(r=this.Level.Data[i][s]),r>0&&(r=8*Math.sin((r-this.Delta)/4*Math.PI)|0),n=this.Background[4*(h%16/4|0)+a][h/16|0],t.drawImage(m.Resources.Images.map,n.X,n.Y,n.Width,n.Height,(i<<4)-e.X,(s<<4)-e.Y-r,n.Width,n.Height))},g.LevelRenderer.prototype.DrawExit0=function(t,e,i){var s=0,h=0,a=null;for(s=this.Level.ExitY-8;s<this.Level.ExitY;s++)a=this.Background[12][s===this.Level.ExitY-8?4:5],t.drawImage(m.Resources.Images.map,a.X,a.Y,a.Width,a.Height,(this.Level.ExitX<<4)-e.X-16,(s<<4)-e.Y,a.Width,a.Height);i&&(h=16*this.Level.ExitY-48-3*Math.sin(this.AnimTime)*16-8,a=this.Background[12][3],t.drawImage(m.Resources.Images.map,a.X,a.Y,a.Width,a.Height,(this.Level.ExitX<<4)-e.X-16,h-e.Y,a.Width,a.Height),a=this.Background[13][3],t.drawImage(m.Resources.Images.map,a.X,a.Y,a.Width,a.Height,(this.Level.ExitX<<4)-e.X,h-e.Y,a.Width,a.Height))},g.LevelRenderer.prototype.DrawExit1=function(t,e){var i=0,s=null;for(i=this.Level.ExitY-8;i<this.Level.ExitY;i++)s=this.Background[13][i===this.Level.ExitY-8?4:5],t.drawImage(m.Resources.Images.map,s.X,s.Y,s.Width,s.Height,(this.Level.ExitX<<4)-e.X+16,(i<<4)-e.Y,s.Width,s.Height)},g.LevelGenerator=function(t,e){this.Width=t,this.Height=e,this.Odds=[],this.TotalOdds=0,this.Difficulty=0,this.Type=0},g.LevelGenerator.prototype={CreateLevel:function(t,e){var i,s=0,h=0,a=0,r=0,n=0,o=0,l=null;for(this.Type=t,this.Difficulty=e,this.Odds[g.Odds.Straight]=20,this.Odds[g.Odds.HillStraight]=10,this.Odds[g.Odds.Tubes]=2+e,this.Odds[g.Odds.Jump]=2*e,this.Odds[g.Odds.Cannon]=5*e-10,this.Type!==g.LevelType.Overground&&(this.Odds[g.Odds.HillStraight]=0),s=0;s<this.Odds.length;s++)this.Odds[s]<0&&(this.Odds[s]=0),this.TotalOdds+=this.Odds[s],this.Odds[s]=this.TotalOdds-this.Odds[s];for(l=new g.Level(this.Width,this.Height),h+=this.BuildStraight(l,0,l.Width,!0);h<l.Width-64;)h+=this.BuildZone(l,h,l.Width-h);for(i=this.Height-1-4*Math.random()|0,l.ExitX=h+8,l.ExitY=i,a=h;a<l.Width;a++)for(r=0;r<this.Height;r++)r>=i&&l.SetBlock(a,r,145);if(t===g.LevelType.Castle||t===g.LevelType.Underground)for(a=0;a<l.Width;a++)for(o--<=0&&a>4&&(n=4*Math.random()|0,o=4+(4*Math.random()|0)),r=0;r<l.Height;r++)(a>4&&r<=n||a<1)&&l.SetBlock(a,r,145);return this.FixWalls(l),l},BuildZone:function(t,e,i){var s=Math.random()*this.TotalOdds|0,h=0,a=0;for(a=0;a<this.Odds.length;a++)this.Odds[a]<=s&&(h=a);switch(h){case g.Odds.Straight:return this.BuildStraight(t,e,i,!1);case g.Odds.HillStraight:return this.BuildHillStraight(t,e,i);case g.Odds.Tubes:return this.BuildTubes(t,e,i);case g.Odds.Jump:return this.BuildJump(t,e,i);case g.Odds.Cannons:return this.BuildCannons(t,e,i)}return 0},BuildJump:function(t,e,i){var s=2+(4*Math.random()|0),h=2*s+(2+(2*Math.random()|0)),a=0,r=0,n=0===(3*Math.random()|0),o=this.Height-1-(4*Math.random()|0);for(a=e;a<e+h;a++)if(a<e+s||a>e+h-s-1)for(r=0;r<this.Height;r++)r>=o?t.SetBlock(a,r,145):n&&(a<e+s?r>=o-(a-e)+1&&t.SetBlock(a,r,9):r>=o-(e+h-a)+2&&t.SetBlock(a,r,9));return h},BuildCannons:function(t,e,i){alert("cannons");var s=2+(10*Math.random()|0),h=this.Height-1-4*Math.random()|0,a=e+1+4*Math.random()|0,r=0,n=0,o=0;for(s>i&&(s=i),r=e;r<e+s;r++)for(r>a&&(a+=4*Math.random()*2|0),a===e+s-1&&(a+=10),o=h-(4*Math.random()|0)-1,n=0;n<this.Height;n++)n>=h?t.SetBlock(r,n,145):r===a&&n>=o&&(n===o?t.SetBlock(r,n,14):n===o+1?t.SetBlock(r,n,30):t.SetBlock(r,n,46));return s},BuildHillStraight:function(t,e,i){var s=10+(10*Math.random()|0),h=this.Height-1-4*Math.random()|0,a=0,r=0,n=h,o=!0,l=0,c=0,d=[],u=0,p=0;for(s>i&&(s=i),a=e;a<e+s;a++)for(r=0;r<this.Height;r++)r>=h&&t.SetBlock(a,r,145);for(this.AddEnemyLine(t,e+1,e+s-1,h-1);o;)if((n=n-2-3*Math.random()|0)<=0)o=!1;else if(l=3+(5*Math.random()|0),d[(c=(Math.random()*(s-l-2)|0)+e+1)-e]||d[c-e+l]||d[c-e-1]||d[c-e+l+1])o=!1;else for(d[c-e]=!0,d[c-e+l]=!0,this.AddEnemyLine(t,c,c+l,n-1),0===(4*Math.random()|0)&&(this.Decorate(t,c-1,c+l+1,n),o=!1),a=c;a<c+l;a++)for(r=n;r<h;r++)u=5,p=9,a===c&&(u=4),a===c+l-1&&(u=6),r===n&&(p=8),0===t.GetBlock(a,r)?t.SetBlock(a,r,u+16*p):(132===t.GetBlock(a,r)&&t.SetBlock(a,r,180),134===t.GetBlock(a,r)&&t.SetBlock(a,r,182));return s},AddEnemyLine:function(t,e,i,s){var h=0,a=0;for(h=e;h<i;h++)(35*Math.random()|0)<this.Difficulty+1&&(a=4*Math.random()|0,this.Difficulty<1?a=g.Enemy.Goomba:this.Difficulty<3&&(a=3*Math.random()|0),t.SetSpriteTemplate(h,s,new g.SpriteTemplate(a,(35*Math.random()|0)<this.Difficulty)))},BuildTubes:function(t,e,i){var s=5+(10*Math.random()|0),h=this.Height-1-4*Math.random()|0,a=e+1+4*Math.random()|0,r=h-(2*Math.random()|0)-2,n=0,o=0,l=0;for(s>i&&(s=i),n=e;n<e+s;n++)for(n>a+1&&(a+=3+(4*Math.random()|0),r=h-(2*Math.random()|0)-2),a>=e+s-2&&(a+=10),n===a&&(11*Math.random()|0)<this.Difficulty+1&&t.SetSpriteTemplate(n,r,new g.SpriteTemplate(g.Enemy.Flower,!1)),o=0;o<this.Height;o++)o>=h?t.SetBlock(n,o,145):(n===a||n===a+1)&&o>=r&&(l=10+n-a,o===r?t.SetBlock(n,o,l):t.SetBlock(n,o,l+16));return s},BuildStraight:function(t,e,i,s){var h=2+(10*Math.random()|0),a=this.Height-1-(4*Math.random()|0),r=0,n=0;for(s&&(h=10+(5*Math.random()|0)),h>i&&(h=i),r=e;r<e+h;r++)for(n=0;n<this.Height;n++)n>=a&&t.SetBlock(r,n,145);return s||h>5&&this.Decorate(t,e,e+h,a),h},Decorate:function(t,e,i,s){if(!(s<1)){var h=4*Math.random()|0,a=4*Math.random()|0,r=0;if(this.AddEnemyLine(t,e+1,i-1,s-1),s-2>0&&i-1-a-(e+1+h)>1)for(r=e+1+h;r<i-1-a;r++)t.SetBlock(r,s-2,34);if(h=4*Math.random()|0,a=4*Math.random()|0,s-4>0&&i-1-a-(e+1+h)>2)for(r=e+1+h;r<i-1-a;r++)r!==e+1&&r!==i-2&&0===(3*Math.random()|0)?0===(4*Math.random()|0)?t.SetBlock(r,s-4,22):t.SetBlock(r,s-4,21):0===(4*Math.random()|0)?0===(4*Math.random()|0)?t.SetBlock(r,s-4,18):t.SetBlock(r,s-4,17):t.SetBlock(r,s-4,16)}},FixWalls:function(t){var e=[],i=0,s=0,h=0,a=0,r=0;for(i=0;i<this.Width+1;i++)for(e[i]=[],s=0;s<this.Height+1;s++){for(r=0,h=i-1;h<i+1;h++)for(a=s-1;a<s+1;a++)145===t.GetBlockCapped(h,a)&&r++;e[i][s]=4===r}this.Blockify(t,e,this.Width+1,this.Height+1)},Blockify:function(t,e,i,s){var h=0,a=[],r=0,n=0,o=0,l=0,c=0,d=0,u=0;for(c=0;c<2;c++)a[c]=[];for(this.Type===g.LevelType.Castle?h=8:this.Type===g.LevelType.Underground&&(h=12),r=0;r<i;r++)for(n=0;n<s;n++){for(o=r;o<=r+1;o++)for(l=n;l<=n+1;l++)(d=o)<0&&(d=0),(u=l)<0&&(u=0),d>i-1&&(d=i-1),u>s-1&&(u=s-1),a[o-r][l-n]=e[d][u];a[0][0]===a[1][0]&&a[0][1]===a[1][1]?a[0][0]===a[0][1]?a[0][0]&&t.SetBlock(r,n,145+h):a[0][0]?t.SetBlock(r,n,161+h):t.SetBlock(r,n,129+h):a[0][0]===a[0][1]&&a[1][0]===a[1][1]?a[0][0]?t.SetBlock(r,n,146+h):t.SetBlock(r,n,144+h):a[0][0]===a[1][1]&&a[0][1]===a[1][0]?t.SetBlock(r,n,145+h):a[0][0]===a[1][0]?a[0][0]?a[0][1]?t.SetBlock(r,n,163+h):t.SetBlock(r,n,179+h):a[0][1]?t.SetBlock(r,n,130+h):t.SetBlock(r,n,128+h):a[0][1]===a[1][1]?a[0][1]?a[0][0]?t.SetBlock(r,n,147+h):t.SetBlock(r,n,131+h):a[0][0]?t.SetBlock(r,n,162+h):t.SetBlock(r,n,160+h):t.SetBlock(r,n,1+16*h)}}},g.SpriteTemplate=function(t,e){this.Type=t,this.Winged=e,this.LastVisibleTick=-1,this.IsDead=!1,this.Sprite=null},g.SpriteTemplate.prototype={Spawn:function(t,e,i,s){this.IsDead||(this.Type===g.Enemy.Flower?this.Sprite=new g.FlowerEnemy(t,16*e+15,16*i+24):this.Sprite=new g.Enemy(t,16*e+8,16*i+15,s,this.Type,this.Winged),this.Sprite.SpriteTemplate=this,t.AddSprite(this.Sprite))}},g.Enemy=function(t,e,i,s,h,a){this.GroundInertia=.89,this.AirInertia=.89,this.RunTime=0,this.OnGround=!1,this.MayJump=!1,this.JumpTime=0,this.XJumpSpeed=0,this.YJumpSpeed=0,this.Width=4,this.Height=24,this.DeadTime=0,this.FlyDeath=!1,this.WingTime=0,this.NoFireballDeath=!1,this.X=e,this.Y=i,this.World=t,this.Type=h,this.Winged=a,this.Image=m.Resources.Images.enemies,this.XPicO=8,this.YPicO=31,this.AvoidCliffs=this.Type===g.Enemy.RedKoopa,this.NoFireballDeath=this.Type===g.Enemy.Spiky,this.YPic=this.Type,this.YPic>1&&(this.Height=12),this.Facing=s,0===this.Facing&&(this.Facing=1),this.PicWidth=16},g.Enemy.prototype=new g.NotchSprite,g.Enemy.prototype.CollideCheck=function(){if(0===this.DeadTime){var t=g.MarioCharacter.X-this.X,e=g.MarioCharacter.Y-this.Y;t>2*-this.Width-4&&t<2*this.Width+4&&e>-this.Height&&e<g.MarioCharacter.Height&&(!(this.Type!==g.Enemy.Spiky&&g.MarioCharacter.Ya>0&&e<=0)||g.MarioCharacter.OnGround&&g.MarioCharacter.WasOnGround?g.MarioCharacter.GetHurt():(g.MarioCharacter.Stomp(this),this.Winged?(this.Winged=!1,this.Ya=0):(this.YPicO=7,this.PicHeight=8,null!==this.SpriteTemplate&&(this.SpriteTemplate.IsDead=!0),this.DeadTime=10,this.Winged=!1,this.Type===g.Enemy.RedKoopa?this.World.AddSprite(new g.Shell(this.World,this.X,this.Y,0)):this.Type===g.Enemy.GreenKoopa&&this.World.AddSprite(new g.Shell(this.World,this.X,this.Y,1)))))}},g.Enemy.prototype.Move=function(){var t=0,e=0;if(this.WingTime++,this.DeadTime>0){if(this.DeadTime--,0===this.DeadTime){for(this.DeadTime=1,t=0;t<8;t++)this.World.AddSprite(new g.Sparkle(this.World,4+(this.X+16*Math.random()-8|0),4+(this.Y-8*Math.random()|0),2*Math.random()-1,-1*Math.random(),0,1,5));this.World.RemoveSprite(this)}this.FlyDeath&&(this.X+=this.Xa,this.Y+=this.Ya,this.Ya*=.95,this.Ya+=1)}else this.Xa>2&&(this.Facing=1),this.Xa<-2&&(this.Facing=-1),this.Xa=1.75*this.Facing,this.MayJump=this.OnGround,this.XFlip=-1===this.Facing,this.RunTime+=Math.abs(this.Xa)+5,e=(this.RunTime/20|0)%2,this.OnGround||(e=1),this.SubMove(this.Xa,0)||(this.Facing=-this.Facing),this.OnGround=!1,this.SubMove(0,this.Ya),this.Ya*=this.Winged?.95:.85,this.OnGround?this.Xa*=this.GroundInertia:this.Xa*=this.AirInertia,this.OnGround?this.Winged&&(this.Ya=-10):this.Winged?this.Ya+=.6:this.Ya+=2,this.Winged&&(e=(this.WingTime/4|0)%2),this.XPic=e},g.Enemy.prototype.SubMove=function(t,e){for(var i=!1;t>8;){if(!this.SubMove(8,0))return!1;t-=8}for(;t<-8;){if(!this.SubMove(-8,0))return!1;t+=8}for(;e>8;){if(!this.SubMove(0,8))return!1;e-=8}for(;e<-8;){if(!this.SubMove(0,-8))return!1;e+=8}return e>0&&(this.IsBlocking(this.X+t-this.Width,this.Y+e,t,0)?i=!0:this.IsBlocking(this.X+t+this.Width,this.Y+e,t,0)?i=!0:this.IsBlocking(this.X+t-this.Width,this.Y+e+1,t,e)?i=!0:this.IsBlocking(this.X+t+this.Width,this.Y+e+1,t,e)&&(i=!0)),e<0&&(this.IsBlocking(this.X+t,this.Y+e-this.Height,t,e)?i=!0:i||this.IsBlocking(this.X+t-this.Width,this.Y+e-this.Height,t,e)?i=!0:(i||this.IsBlocking(this.X+t+this.Width,this.Y+e-this.Height,t,e))&&(i=!0)),t>0&&(this.IsBlocking(this.X+t+this.Width,this.Y+e-this.Height,t,e)&&(i=!0),this.IsBlocking(this.X+t+this.Width,this.Y+e-(this.Height/2|0),t,e)&&(i=!0),this.IsBlocking(this.X+t+this.Width,this.Y+e,t,e)&&(i=!0),this.AvoidCliffs&&this.OnGround&&!this.World.Level.IsBlocking((this.X+this.Xa+this.Width)/16|0,this.Y/16+1|0,this.Xa,1)&&(i=!0)),t<0&&(this.IsBlocking(this.X+t-this.Width,this.Y+e-this.Height,t,e)&&(i=!0),this.IsBlocking(this.X+t-this.Width,this.Y+e-(this.Height/2|0),t,e)&&(i=!0),this.IsBlocking(this.X+t-this.Width,this.Y+e,t,e)&&(i=!0),this.AvoidCliffs&&this.OnGround&&!this.World.Level.IsBlocking((this.X+this.Xa-this.Width)/16|0,this.Y/16+1|0,this.Xa,1)&&(i=!0)),i?(t<0&&(this.X=16*((this.X-this.Width)/16|0)+this.Width,this.Xa=0),t>0&&(this.X=16*((this.X+this.Width)/16+1|0)-this.Width-1,this.Xa=0),e<0&&(this.Y=16*((this.Y-this.Height)/16|0)+this.Height,this.JumpTime=0,this.Ya=0),e>0&&(this.Y=16*((this.Y-1)/16+1|0)-1,this.OnGround=!0),!1):(this.X+=t,this.Y+=e,!0)},g.Enemy.prototype.IsBlocking=function(t,e,i,s){return e=e/16|0,!((t=t/16|0)===this.X/16|0&&e===this.Y/16|0)&&this.World.Level.IsBlocking(t,e,i,s)},g.Enemy.prototype.ShellCollideCheck=function(t){if(0!==this.DeadTime)return!1;var e=t.X-this.X,i=t.Y-this.Y;return e>-16&&e<16&&i>-this.Height&&i<t.Height&&(m.Resources.PlaySound("kick"),this.Xa=2*t.Facing,this.Ya=-5,this.FlyDeath=!0,null!==this.SpriteTemplate&&(this.SpriteTemplate.IsDead=!0),this.DeadTime=100,this.Winged=!1,this.YFlip=!0,!0)},g.Enemy.prototype.FireballCollideCheck=function(t){if(0!==this.DeadTime)return!1;var e=t.X-this.X,i=t.Y-this.Y;return e>-16&&e<16&&i>-this.Height&&i<t.Height?!!this.NoFireballDeath||(m.Resources.PlaySound("kick"),this.Xa=2*t.Facing,this.Ya=-5,this.FlyDeath=!0,null!==this.SpriteTemplate&&(this.SpriteTemplate.IsDead=!0),this.DeadTime=100,this.Winged=!1,this.YFlip=!0,!0):void 0},g.Enemy.prototype.BumpCheck=function(t,e){0===this.DeadTime&&this.X+this.Width>16*t&&this.X-this.Width<16*t+16&&e===(this.Y-1)/16|0&&(m.Resources.PlaySound("kick"),this.Xa=2*-g.MarioCharacter.Facing,this.Ya=-5,this.FlyDeath=!0,null!==this.SpriteTemplate&&(this.SpriteTemplate.IsDead=!0),this.DeadTime=100,this.Winged=!1,this.YFlip=!0)},g.Enemy.prototype.SubDraw=g.NotchSprite.prototype.Draw,g.Enemy.prototype.Draw=function(t,e){var i=0,s=0;this.Winged&&(i=(this.XOld+(this.X-this.XOld)*this.Delta|0)-this.XPicO,s=(this.YOld+(this.Y-this.YOld)*this.Delta|0)-this.YPicO,this.Type!==g.Enemy.RedKoopa&&this.Type!==g.Enemy.GreenKoopa&&(this.XFlip=!this.XFlip,t.save(),t.scale(this.XFlip?-1:1,this.YFlip?-1:1),t.translate(this.XFlip?-320:0,this.YFlip?-240:0),t.drawImage(this.Image,(this.WingTime/4|0)%2*16,128,16,32,this.XFlip?320-i-24:i-8,this.YFlip?240-s-32:s-8,16,32),t.restore(),this.XFlip=!this.XFlip)),this.SubDraw(t,e),this.Winged&&(i=(this.XOld+(this.X-this.XOld)*this.Delta|0)-this.XPicO,s=(this.YOld+(this.Y-this.YOld)*this.Delta|0)-this.YPicO,this.Type===g.Enemy.RedKoopa&&this.Type===g.Enemy.GreenKoopa?(t.save(),t.scale(this.XFlip?-1:1,this.YFlip?-1:1),t.translate(this.XFlip?-320:0,this.YFlip?-240:0),t.drawImage(this.Image,(this.WingTime/4|0)%2*16,128,16,32,this.XFlip?320-i-24:i-8,this.YFlip?240-s:s-8,16,32),t.restore()):(t.save(),t.scale(this.XFlip?-1:1,this.YFlip?-1:1),t.translate(this.XFlip?-320:0,this.YFlip?-240:0),t.drawImage(this.Image,(this.WingTime/4|0)%2*16,128,16,32,this.XFlip?320-i-24:i-8,this.YFlip?240-s-32:s-8,16,32),t.restore()))},g.Enemy.RedKoopa=0,g.Enemy.GreenKoopa=1,g.Enemy.Goomba=2,g.Enemy.Spiky=3,g.Enemy.Flower=4,g.Fireball=function(t,e,i,s){this.GroundInertia=.89,this.AirInertia=.89,this.Image=m.Resources.Images.particles,this.World=t,this.X=e,this.Y=i,this.Facing=s,this.XPicO=4,this.YPicO=4,this.YPic=3,this.XPic=4,this.Height=8,this.Width=4,this.PicWidth=this.PicHeight=8,this.Ya=4,this.Dead=!1,this.DeadTime=0,this.Anim=0,this.OnGround=!1},g.Fireball.prototype=new g.NotchSprite,g.Fireball.prototype.Move=function(){var t=0;if(this.DeadTime>0){for(t=0;t<8;t++)this.World.AddSprite(new g.Sparkle(this.World,4+(this.X+8*Math.random()-4|0),2+(this.Y+8*Math.random()-4|0),2*Math.random()-1*this.Facing,2*Math.random()-1,0,1,5));this.World.RemoveSprite(this)}else 0!=this.Facing&&this.Anim++,this.Xa>2&&(this.Facing=1),this.Xa<-2&&(this.Facing=-1),this.Xa=8*this.Facing,this.World.CheckFireballCollide(this),this.FlipX=-1===this.Facing,this.XPic=this.Anim%4,this.SubMove(this.Xa,0)||this.Die(),this.OnGround=!1,this.SubMove(0,this.Ya),this.OnGround&&(this.Ya=-10),this.Ya*=.95,this.OnGround?this.Xa*=this.GroundInertia:this.Xa*=this.AirInertia,this.OnGround||(this.Ya+=1.5)},g.Fireball.prototype.SubMove=function(t,e){for(var i=!1;t>8;){if(!this.SubMove(8,0))return!1;t-=8}for(;t<-8;){if(!this.SubMove(-8,0))return!1;t+=8}for(;e>8;){if(!this.SubMove(0,8))return!1;e-=8}for(;e<-8;){if(!this.SubMove(0,-8))return!1;e+=8}return e>0&&(this.IsBlocking(this.X+t-this.Width,this.Y+e,t,0)?i=!0:this.IsBlocking(this.X+t+this.Width,this.Y+e,t,0)?i=!0:this.IsBlocking(this.X+t-this.Width,this.Y+e+1,t,e)?i=!0:this.IsBlocking(this.X+t+this.Width,this.Y+e+1,t,e)&&(i=!0)),e<0&&(this.IsBlocking(this.X+t,this.Y+e-this.Height,t,e)?i=!0:i||this.IsBlocking(this.X+t-this.Width,this.Y+e-this.Height,t,e)?i=!0:(i||this.IsBlocking(this.X+t+this.Width,this.Y+e-this.Height,t,e))&&(i=!0)),t>0&&(this.IsBlocking(this.X+t+this.Width,this.Y+e-this.Height,t,e)&&(i=!0),this.IsBlocking(this.X+t+this.Width,this.Y+e-(this.Height/2|0),t,e)&&(i=!0),this.IsBlocking(this.X+t+this.Width,this.Y+e,t,e)&&(i=!0)),t<0&&(this.IsBlocking(this.X+t-this.Width,this.Y+e-this.Height,t,e)&&(i=!0),this.IsBlocking(this.X+t-this.Width,this.Y+e-(this.Height/2|0),t,e)&&(i=!0),this.IsBlocking(this.X+t-this.Width,this.Y+e,t,e)&&(i=!0)),i?(t<0&&(this.X=16*((this.X-this.Width)/16|0)+this.Width,this.Xa=0),t>0&&(this.X=16*((this.X+this.Width)/16+1|0)-this.Width-1,this.Xa=0),e<0&&(this.Y=16*((this.Y-this.Height)/16|0)+this.Height,this.Ya=0),e>0&&(this.Y=16*((this.Y-1)/16+1|0)-1,this.OnGround=!0),!1):(this.X+=t,this.Y+=e,!0)},g.Fireball.prototype.IsBlocking=function(t,e,i,s){return e=e/16|0,!((t=t/16|0)===this.X/16|0&&e===this.Y/16|0)&&this.World.Level.IsBlocking(t,e,i,s)},g.Fireball.prototype.Die=function(){this.Dead=!0,this.Xa=2*-this.Facing,this.Ya=-5,this.DeadTime=100},g.Sparkle=function(t,e,i,s,h){this.World=t,this.X=e,this.Y=i,this.Xa=s,this.Ya=h,this.XPic=2*Math.random()|0,this.YPic=0,this.Life=10+(5*Math.random()|0),this.XPicStart=this.XPic,this.XPicO=4,this.YPicO=4,this.PicWidth=8,this.PicHeight=8,this.Image=m.Resources.Images.particles},g.Sparkle.prototype=new g.NotchSprite,g.Sparkle.prototype.Move=function(){this.Life>10?this.XPic=7:this.XPic=this.XPicStart+.4*(10-this.Life)|0,this.Life--<0&&this.World.RemoveSprite(this),this.X+=this.Xa,this.Y+=this.Ya},g.CoinAnim=function(t,e,i){this.World=t,this.Life=10,this.Image=m.Resources.Images.map,this.PicWidth=this.PicHeight=16,this.X=16*e,this.Y=16*i-16,this.Xa=0,this.Ya=-6,this.XPic=0,this.YPic=2},g.CoinAnim.prototype=new g.NotchSprite,g.CoinAnim.prototype.Move=function(){var t=0,e=0;if(this.Life--<0)for(this.World.RemoveSprite(this),t=0;t<2;t++)for(e=0;e<2;e++)this.World.AddSprite(new g.Sparkle(this.World,this.X+8*t+8*Math.random()|0,this.Y+8*e+8*Math.random()|0,0,0,0,2,5));this.XPic=3&this.Life,this.X+=this.Xa,this.Y+=this.Ya,this.Ya+=1},g.Mushroom=function(t,e,i){this.RunTime=0,this.GroundInertia=.89,this.AirInertia=.89,this.OnGround=!1,this.Width=4,this.Height=24,this.World=t,this.X=e,this.Y=i,this.Image=m.Resources.Images.items,this.XPicO=8,this.YPicO=15,this.YPic=0,this.Height=12,this.Facing=1,this.PicWidth=this.PicHeight=16,this.Life=0},g.Mushroom.prototype=new g.NotchSprite,g.Mushroom.prototype.CollideCheck=function(){var t=g.MarioCharacter.X-this.X,e=g.MarioCharacter.Y-this.Y;t>-16&&t<16&&e>-this.Height&&e<g.MarioCharacter.Height&&(g.MarioCharacter.GetMushroom(),this.World.RemoveSprite(this))},g.Mushroom.prototype.Move=function(){if(this.Life<9)return this.Layer=0,this.Y--,void this.Life++;this.Layer=1,this.Xa>2&&(this.Facing=1),this.Xa<-2&&(this.Facing=-1),this.Xa=1.75*this.Facing,this.XFlip=-1===this.Facing,this.RunTime+=Math.abs(this.Xa)+5,this.SubMove(this.Xa,0)||(this.Facing=-this.Facing),this.OnGround=!1,this.SubMove(0,this.Ya),this.Ya*=.85,this.OnGround?this.Xa*=this.GroundInertia:this.Xa*=this.AirInertia,this.OnGround||(this.Ya+=2)},g.Mushroom.prototype.SubMove=function(t,e){for(var i=!1;t>8;){if(!this.SubMove(8,0))return!1;t-=8}for(;t<-8;){if(!this.SubMove(-8,0))return!1;t+=8}for(;e>8;){if(!this.SubMove(0,8))return!1;e-=8}for(;e<-8;){if(!this.SubMove(0,-8))return!1;e+=8}return e>0&&(this.IsBlocking(this.X+t-this.Width,this.Y+e,t,0)?i=!0:this.IsBlocking(this.X+t+this.Width,this.Y+e,t,0)?i=!0:this.IsBlocking(this.X+t-this.Width,this.Y+e+1,t,e)?i=!0:this.IsBlocking(this.X+t+this.Width,this.Y+e+1,t,e)&&(i=!0)),e<0&&(this.IsBlocking(this.X+t,this.Y+e-this.Height,t,e)?i=!0:i||this.IsBlocking(this.X+t-this.Width,this.Y+e-this.Height,t,e)?i=!0:(i||this.IsBlocking(this.X+t+this.Width,this.Y+e-this.Height,t,e))&&(i=!0)),t>0&&(this.IsBlocking(this.X+t+this.Width,this.Y+e-this.Height,t,e)&&(i=!0),this.IsBlocking(this.X+t+this.Width,this.Y+e-(this.Height/2|0),t,e)&&(i=!0),this.IsBlocking(this.X+t+this.Width,this.Y+e,t,e)&&(i=!0)),t<0&&(this.IsBlocking(this.X+t-this.Width,this.Y+e-this.Height,t,e)&&(i=!0),this.IsBlocking(this.X+t-this.Width,this.Y+e-(this.Height/2|0),t,e)&&(i=!0),this.IsBlocking(this.X+t-this.Width,this.Y+e,t,e)&&(i=!0)),i?(t<0&&(this.X=16*((this.X-this.Width)/16|0)+this.Width,this.Xa=0),t>0&&(this.X=16*((this.X+this.Width)/16+1|0)-this.Width-1,this.Xa=0),e<0&&(this.Y=16*((this.Y-this.Height)/16|0)+this.Height,this.JumpTime=0,this.Ya=0),e>0&&(this.Y=16*((this.Y-1)/16+1|0)-1,this.OnGround=!0),!1):(this.X+=t,this.Y+=e,!0)},g.Mushroom.prototype.IsBlocking=function(t,e,i,s){return e=e/16|0,!((t=t/16|0)===this.X/16|0&&e===this.Y/16|0)&&this.World.Level.IsBlocking(t,e,i,s)},g.Mushroom.prototype.BumpCheck=function(t,e){this.X+this.Width>16*t&&this.X-this.Width<16*t-16&&e===(e-1)/16|0&&(this.Facing=-g.MarioCharacter.Facing,this.Ya=-10)},g.Particle=function(t,e,i,s,h,a,r){this.World=t,this.X=e,this.Y=i,this.Xa=s,this.Ya=h,this.XPic=2*Math.random()|0,this.YPic=0,this.XPicO=4,this.YPicO=4,this.PicWidth=8,this.PicHeight=8,this.Life=10,this.Image=m.Resources.Images.particles},g.Particle.prototype=new g.NotchSprite,g.Particle.prototype.Move=function(){this.Life-this.Delta<0&&this.World.RemoveSprite(this),this.Life-=this.Delta,this.X+=this.Xa,this.Y+=this.Ya,this.Ya*=.95,this.Ya+=3},g.FireFlower=function(t,e,i){this.Width=4,this.Height=24,this.World=t,this.X=e,this.Y=i,this.Image=m.Resources.Images.items,this.XPicO=8,this.YPicO=15,this.XPic=1,this.YPic=0,this.Height=12,this.Facing=1,this.PicWidth=this.PicHeight=16,this.Life=0},g.FireFlower.prototype=new g.NotchSprite,g.FireFlower.prototype.CollideCheck=function(){var t=g.MarioCharacter.X-this.X,e=g.MarioCharacter.Y-this.Y;t>-16&&t<16&&e>-this.Height&&e<g.MarioCharacter.Height&&(g.MarioCharacter.GetFlower(),this.World.RemoveSprite(this))},g.FireFlower.prototype.Move=function(){if(this.Life<9)return this.Layer=0,this.Y--,void this.Life++},g.BulletBill=function(t,e,i,s){this.Image=m.Resources.Images.enemies,this.World=t,this.X=e,this.Y=i,this.Facing=s,this.XPicO=8,this.YPicO=31,this.Height=12,this.Width=4,this.PicWidth=16,this.YPic=5,this.XPic=0,this.Ya=-5,this.DeadTime=0,this.Dead=!1,this.Anim=0},g.BulletBill.prototype=new g.NotchSprite,g.BulletBill.prototype.CollideCheck=function(){if(!this.Dead){var t=g.MarioCharacter.X-this.X,e=g.MarioCharacter.Y-this.Y;t>-16&&t<16&&e>-this.Height&&e<this.World.Mario.Height&&(!(g.MarioCharacter.Y>0&&e<=0)||g.MarioCharacter.OnGround&&g.MarioCharacter.WasOnGround?g.MarioCharacter.GetHurt():(g.MarioCharacter.Stomp(this),this.Dead=!0,this.Xa=0,this.Ya=1,this.DeadTime=100))}},g.BulletBill.prototype.Move=function(){var t=0;if(this.DeadTime>0){if(this.DeadTime--,0===this.DeadTime){for(this.DeadTime=1,t=0;t<8;t++)this.World.AddSprite(new g.Sparkle(4+(this.X+16*Math.random()-8|0),4+(this.Y+8*Math.random()|0),2*Math.random()-1,-1*Math.random(),0,1,5));this.World.RemoveSprite(this)}return this.X+=this.Xa,this.Y+=this.Ya,this.Ya*=.95,void(this.Ya+=1)}this.Xa=4*this.Facing,this.XFlip=-1===this.Facing,this.Move(this.Xa,0)},g.BulletBill.prototype.SubMove=function(t,e){return this.X+=t,!0},g.BulletBill.prototype.FireballCollideCheck=function(t){if(0!==this.DeadTime)return!1;var e=t.X-this.X,i=t.Y-this.Y;return e>-16&&e<16&&i>-this.Height&&i<t.Height},g.BulletBill.prototype.ShellCollideCheck=function(t){if(0!==this.DeadTime)return!1;var e=t.X-this.X,i=t.Y-this.Y;return e>-16&&e<16&&i>-this.Height&&i<t.Height&&(m.Resources.PlaySound("kick"),this.Dead=!0,this.Xa=0,this.Ya=1,this.DeadTime=100,!0)},g.FlowerEnemy=function(t,e,i){this.Image=m.Resources.Images.enemies,this.World=t,this.X=e,this.Y=i,this.Facing=1,this.Type=g.Enemy.Spiky,this.Winged=!1,this.NoFireballDeath=!1,this.XPic=0,this.YPic=6,this.YPicO=24,this.Height=12,this.Width=2,this.YStart=i,this.Ya=-8,this.Y-=1,this.Layer=0,this.JumpTime=0,this.Tick=0;var s=0;for(s=0;s<4;s++)this.Move()},g.FlowerEnemy.prototype=new g.Enemy,g.FlowerEnemy.prototype.Move=function(){var t=0,e=0;if(this.DeadTime>0){if(this.DeadTime--,0===this.DeadTime){for(this.DeadTime=1,t=0;t<8;t++)this.World.AddSprite(new g.Sparkle(4+(this.X+16*Math.random()-8|0),4+(this.Y+8*Math.random()|0),2*Math.random()-1,-1*Math.random(),0,1,5));this.World.RemoveSprite(this)}return this.X+=this.Xa,this.Y+=this.Ya,this.Ya*=.95,void(this.Ya+=1)}this.Tick++,this.Y>=this.YStart?(this.YStart=this.Y,e=0|Math.abs(g.MarioCharacter.X-this.X),this.JumpTime++,this.JumpTime>40&&e>24?this.Ya=-8:this.Ya=0):this.JumpTime=0,this.Y+=this.Ya,this.Ya*=.9,this.Ya+=.1,this.XPic=2*(1&(this.Tick/2|0))+(1&(this.Tick/6|0))},g.Shell=function(t,e,i,s){this.World=t,this.X=e,this.Y=i,this.YPic=s,this.Image=m.Resources.Images.enemies,this.XPicO=8,this.YPicO=31,this.Width=4,this.Height=12,this.Facing=0,this.PicWidth=16,this.XPic=4,this.Ya=-5,this.Dead=!1,this.DeadTime=0,this.Carried=!1,this.GroundInertia=.89,this.AirInertia=.89,this.OnGround=!1,this.Anim=0},g.Shell.prototype=new g.NotchSprite,g.Shell.prototype.FireballCollideCheck=function(t){if(0!==this.DeadTime)return!1;var e=t.X-this.X,i=t.Y-this.Y;return e>-16&&e<16&&i>-this.Height&&i<t.Height&&(0!==this.Facing||(m.Resources.PlaySound("kick"),this.Xa=2*t.Facing,this.Ya=-5,null!==this.SpriteTemplate&&(this.SpriteTemplate.IsDead=!0),this.DeadTime=100,this.YFlip=!0,!0))},g.Shell.prototype.CollideCheck=function(){if(!(this.Carried||this.Dead||this.DeadTime>0)){var t=g.MarioCharacter.X-this.X,e=g.MarioCharacter.Y-this.Y;t>-16&&t<16&&e>-this.Height&&e<g.MarioCharacter.Height&&(!(g.MarioCharacter.Ya>0&&e<=0)||g.MarioCharacter.OnGround&&g.MarioCharacter.WasOnGround?0!==this.Facing?g.MarioCharacter.GetHurt():(g.MarioCharacter.Kick(this),this.Facing=g.MarioCharacter.Facing):(g.MarioCharacter.Stomp(this),0!==this.Facing?(this.Xa=0,this.Facing=0):this.Facing=g.MarioCharacter.Facing))}},g.Shell.prototype.Move=function(){var t=0;if(this.Carried)this.World.CheckShellCollide(this);else{if(this.DeadTime>0){if(this.DeadTime--,0===this.DeadTime){for(this.DeadTime=1,t=0;t<8;t++)this.World.AddSprite(new g.Sparkle(4+(this.X+16*Math.random()-8|0),4+(this.Y+8*Math.random()|0),2*Math.random()-1,-1*Math.random(),0,1,5));this.World.RemoveSprite(this)}return this.X+=this.Xa,this.Y+=this.Ya,this.Ya*=.95,void(this.Ya+=1)}0!==this.Facing&&this.Anim++,this.Xa>2&&(this.Facing=1),this.Xa<-2&&(this.Facing=-1),this.Xa=11*this.Facing,0!==this.Facing&&this.World.CheckShellCollide(this),this.XFlip=-1===this.Facing,this.XPic=(this.Anim/2|0)%4+3,this.SubMove(this.Xa,0)||(m.Resources.PlaySound("bump"),this.Facing=-this.Facing),this.OnGround=!1,this.SubMove(0,this.Ya),this.Ya*=.85,this.OnGround?this.Xa*=this.GroundInertia:this.Xa*=this.AirInertia,this.OnGround||(this.Ya+=2)}},g.Shell.prototype.SubMove=function(t,e){for(var i=!1;t>8;){if(!this.SubMove(8,0))return!1;t-=8}for(;t<-8;){if(!this.SubMove(-8,0))return!1;t+=8}for(;e>8;){if(!this.SubMove(0,8))return!1;e-=8}for(;e<-8;){if(!this.SubMove(0,-8))return!1;e+=8}return e>0&&(this.IsBlocking(this.X+t-this.Width,this.Y+e,t,0)?i=!0:this.IsBlocking(this.X+t+this.Width,this.Y+e,t,0)?i=!0:this.IsBlocking(this.X+t-this.Width,this.Y+e+1,t,e)?i=!0:this.IsBlocking(this.X+t+this.Width,this.Y+e+1,t,e)&&(i=!0)),e<0&&(this.IsBlocking(this.X+t,this.Y+e-this.Height,t,e)?i=!0:i||this.IsBlocking(this.X+t-this.Width,this.Y+e-this.Height,t,e)?i=!0:(i||this.IsBlocking(this.X+t+this.Width,this.Y+e-this.Height,t,e))&&(i=!0)),t>0&&(this.IsBlocking(this.X+t+this.Width,this.Y+e-this.Height,t,e)&&(i=!0),this.IsBlocking(this.X+t+this.Width,this.Y+e-(this.Height/2|0),t,e)&&(i=!0),this.IsBlocking(this.X+t+this.Width,this.Y+e,t,e)&&(i=!0)),t<0&&(this.IsBlocking(this.X+t-this.Width,this.Y+e-this.Height,t,e)&&(i=!0),this.IsBlocking(this.X+t-this.Width,this.Y+e-(this.Height/2|0),t,e)&&(i=!0),this.IsBlocking(this.X+t-this.Width,this.Y+e,t,e)&&(i=!0)),i?(t<0&&(this.X=16*((this.X-this.Width)/16|0)+this.Width,this.Xa=0),t>0&&(this.X=16*((this.X+this.Width)/16+1|0)-this.Width-1,this.Xa=0),e<0&&(this.Y=16*((this.Y-this.Height)/16|0)+this.Height,this.Ya=0),e>0&&(this.Y=16*((this.Y-1)/16+1|0)-1,this.OnGround=!0),!1):(this.X+=t,this.Y+=e,!0)},g.Shell.prototype.IsBlocking=function(t,e,i,s){if(e=e/16|0,(t=t/16|0)===(this.X/16|0)&&e===(this.Y/16|0))return!1;var h=this.World.Level.IsBlocking(t,e,i,s);return h&&0===s&&0!==i&&this.World.Bump(t,e,!0),h},g.Shell.prototype.BumpCheck=function(t,e){this.X+this.Width>16*t&&this.X-this.Width<16*t+16&&e===((this.Y-1)/16|0)&&(this.Facing=-g.MarioCharacter.Facing,this.Ya=-10)},g.Shell.prototype.Die=function(){this.Dead=!0,this.Carried=!1,this.Xa=2*-this.Facing,this.Ya=-5,this.DeadTime=100},g.Shell.prototype.ShellCollideCheck=function(t){if(0!==this.DeadTime)return!1;var e=t.X-this.X,i=t.Y-this.Y;return e>-16&&e<16&&i>-this.Height&&i<t.Height&&(m.Resources.PlaySound("kick"),g.MarioCharacter.Carried!==t&&g.MarioCharacter.Carried!==this||(g.MarioCharacter.Carried=null),this.Die(),t.Die(),!0)},g.Shell.prototype.Release=function(t){this.Carried=!1,this.Facing=g.MarioCharacter.Facing,this.X+=8*this.Facing},g.TitleState=function(){this.drawManager=null,this.camera=null,this.logoY=null,this.bounce=null,this.font=null},g.TitleState.prototype=new m.GameState,g.TitleState.prototype.Enter=function(){this.drawManager=new m.DrawableManager,this.camera=new m.Camera;var t=new g.BackgroundGenerator(2048,15,!0,g.LevelType.Overground),e=new g.BackgroundRenderer(t.CreateLevel(),320,240,2);t.SetValues(2048,15,!1,g.LevelType.Overground);var i=new g.BackgroundRenderer(t.CreateLevel(),320,240,1);this.title=new m.Sprite,this.title.Image=m.Resources.Images.title,this.title.X=0,this.title.Y=120,this.logo=new m.Sprite,this.logo.Image=m.Resources.Images.logo,this.logo.X=0,this.logo.Y=0,this.font=g.SpriteCuts.CreateRedFont(),this.font.Strings[0]={String:"Press S to Start",X:96,Y:110},this.font.Strings[1]={String:"(S) Jump  (A)Fire",X:96,Y:120},this.logoY=20,this.drawManager.Add(e),this.drawManager.Add(i),this.bounce=0,g.GlobalMapState=new g.MapState,g.MarioCharacter=new g.Character,g.MarioCharacter.Image=m.Resources.Images.smallMario,g.PlayTitleMusic()},g.TitleState.prototype.Exit=function(){g.StopMusic(),this.drawManager.Clear(),delete this.drawManager,delete this.camera,delete this.font},g.TitleState.prototype.Update=function(t){this.bounce+=2*t,this.logoY=20+10*Math.sin(this.bounce),this.camera.X+=25*t,this.drawManager.Update(t)},g.TitleState.prototype.Draw=function(t){this.drawManager.Draw(t,this.camera),t.drawImage(m.Resources.Images.title,0,120),t.drawImage(m.Resources.Images.logo,0,this.logoY),this.font.Draw(t,this.Camera)},g.TitleState.prototype.CheckForChange=function(t){m.KeyboardInput.IsKeyDown(m.Keys.S)&&(t.ChangeState(g.GlobalMapState),f()(document).trigger("enterGame"))},g.LoadingState=function(t){this.Images=[],this.ImagesLoaded=!1,this.ScreenColor=0,this.ColorDirection=1,this.ImageIndex=0,this.SoundIndex=0,this.mobile=!1,t&&(this.mobile=!0)},g.LoadingState.prototype=new m.GameState,g.LoadingState.prototype.Enter=function(){var t=0;for(t=0;t<15;t++)this.Images[t]={};this.Images[0].name="background",this.Images[1].name="endScene",this.Images[2].name="enemies",this.Images[3].name="fireMario",this.Images[4].name="font",this.Images[5].name="gameOverGhost",this.Images[6].name="items",this.Images[7].name="logo",this.Images[8].name="map",this.Images[9].name="mario",this.Images[10].name="particles",this.Images[11].name="racoonMario",this.Images[12].name="smallMario",this.Images[13].name="title",this.Images[14].name="worldMap",this.Images[0].src="images/bgsheet.png",this.Images[1].src="images/endscene.gif",this.Images[2].src="images/enemysheet.png",this.Images[3].src="images/firemariosheet.png",this.Images[4].src="images/font.gif",this.Images[5].src="images/gameovergost.gif",this.Images[6].src="images/itemsheet.png",this.Images[7].src="images/logo.gif",this.Images[8].src="images/mapsheet.png",this.Images[9].src="images/mariosheet.png",this.Images[10].src="images/particlesheet.png",this.Images[11].src="images/racoonmariosheet.png",this.Images[12].src="images/smallmariosheet.png",this.Images[13].src="images/title.gif",this.Images[14].src="images/worldmap.png",m.Resources.AddImages(this.Images),(new Audio).canPlayType("audio/mp3")?m.Resources.AddSound("1up","sounds/1-up.mp3",1).AddSound("breakblock","sounds/breakblock.mp3").AddSound("bump","sounds/bump.mp3",4).AddSound("cannon","sounds/cannon.mp3").AddSound("coin","sounds/coin.mp3",5).AddSound("death","sounds/death.mp3",1).AddSound("exit","sounds/exit.mp3",1).AddSound("fireball","sounds/fireball.mp3",1).AddSound("jump","sounds/jump.mp3").AddSound("kick","sounds/kick.mp3").AddSound("pipe","sounds/pipe.mp3",1).AddSound("powerdown","sounds/powerdown.mp3",1).AddSound("powerup","sounds/powerup.mp3",1).AddSound("sprout","sounds/sprout.mp3",1).AddSound("stagestart","sounds/stagestart.mp3",1).AddSound("stomp","sounds/stomp.mp3",2):m.Resources.AddSound("1up","sounds/1-up.wav",1).AddSound("breakblock","sounds/breakblock.wav").AddSound("bump","sounds/bump.wav",2).AddSound("cannon","sounds/cannon.wav").AddSound("coin","sounds/coin.wav",5).AddSound("death","sounds/death.wav",1).AddSound("exit","sounds/exit.wav",1).AddSound("fireball","sounds/fireball.wav",1).AddSound("jump","sounds/jump.wav",1).AddSound("kick","sounds/kick.wav",1).AddSound("message","sounds/message.wav",1).AddSound("pipe","sounds/pipe.wav",1).AddSound("powerdown","sounds/powerdown.wav",1).AddSound("powerup","sounds/powerup.wav",1).AddSound("sprout","sounds/sprout.wav",1).AddSound("stagestart","sounds/stagestart.wav",1).AddSound("stomp","sounds/stomp.wav",1),g.Tile.LoadBehaviors()},g.LoadingState.prototype.Exit=function(){delete this.Images},g.LoadingState.prototype.Update=function(t){if(!this.ImagesLoaded){this.ImagesLoaded=!0;var e=0;for(e=0;e<this.Images.length;e++)if(!0!==m.Resources.Images[this.Images[e].name].complete){this.ImagesLoaded=!1;break}}this.ScreenColor+=255*this.ColorDirection*t,this.ScreenColor>255?(this.ScreenColor=255,this.ColorDirection=-1):this.ScreenColor<0&&(this.ScreenColor=0,this.ColorDirection=1)},g.LoadingState.prototype.Draw=function(t){var e=640,i=480,s=e/i;if(this.mobile&&(i=window.innerHeight-20,(e=window.innerWidth-20)>i?e=Math.round(s*i):i=Math.round(e/s),f()("#canvas").attr("width",e),f()("#canvas").attr("height",i)),this.ImagesLoaded)t.fillStyle="rgb(0, 0, 0)",t.fillRect(0,0,e,i);else{var h=parseInt(this.ScreenColor,10);t.fillStyle="rgb("+h+","+h+","+h+")",t.fillRect(0,0,e,i)}},g.LoadingState.prototype.CheckForChange=function(t){this.ImagesLoaded&&(g.GlobalMapState=new g.MapState,t.ChangeState(new g.TitleState))},g.LoseState=function(){this.drawManager=null,this.camera=null,this.gameOver=null,this.font=null,this.wasKeyDown=!1},g.LoseState.prototype=new m.GameState,g.LoseState.prototype.Enter=function(){this.drawManager=new m.DrawableManager,this.camera=new m.Camera,this.gameOver=new m.AnimatedSprite,this.gameOver.Image=m.Resources.Images.gameOverGhost,this.gameOver.SetColumnCount(9),this.gameOver.SetRowCount(1),this.gameOver.AddNewSequence("turnLoop",0,0,0,8),this.gameOver.PlaySequence("turnLoop",!0),this.gameOver.FramesPerSecond=1/15,this.gameOver.X=112,this.gameOver.Y=68,this.font=g.SpriteCuts.CreateBlackFont(),this.font.Strings[0]={String:"Game over!",X:116,Y:160},this.drawManager.Add(this.font),this.drawManager.Add(this.gameOver),f()(document).trigger("enterTitleState")},g.LoseState.prototype.Exit=function(){this.drawManager.Clear(),delete this.drawManager,delete this.camera,delete this.gameOver,delete this.font},g.LoseState.prototype.Update=function(t){this.drawManager.Update(t),m.KeyboardInput.IsKeyDown(m.Keys.S)&&(this.wasKeyDown=!0)},g.LoseState.prototype.Draw=function(t){this.drawManager.Draw(t,this.camera)},g.LoseState.prototype.CheckForChange=function(t){this.wasKeyDown&&!m.KeyboardInput.IsKeyDown(m.Keys.S)&&t.ChangeState(new g.TitleState)},g.WinState=function(){this.waitTime=2,this.drawManager=null,this.camera=null,this.font=null,this.kissing=null,this.wasKeyDown=!1},g.WinState.prototype=new m.GameState,g.WinState.prototype.Enter=function(){this.drawManager=new m.DrawableManager,this.camera=new m.Camera,this.font=g.SpriteCuts.CreateBlackFont(),this.font.Strings[0]={String:"Thank you for saving me, Mario!",X:36,Y:160},this.kissing=new m.AnimatedSprite,this.kissing.Image=m.Resources.Images.endScene,this.kissing.X=112,this.kissing.Y=52,this.kissing.SetColumnCount(2),this.kissing.SetRowCount(1),this.kissing.AddNewSequence("loop",0,0,0,1),this.kissing.PlaySequence("loop",!0),this.kissing.FramesPerSecond=.5,this.waitTime=2,this.drawManager.Add(this.font),this.drawManager.Add(this.kissing)},g.WinState.prototype.Exit=function(){this.drawManager.Clear(),delete this.drawManager,delete this.camera},g.WinState.prototype.Update=function(t){this.drawManager.Update(t),this.waitTime>0?this.waitTime-=t:m.KeyboardInput.IsKeyDown(m.Keys.S)&&(this.wasKeyDown=!0)},g.WinState.prototype.Draw=function(t){this.drawManager.Draw(t,this.camera)},g.WinState.prototype.CheckForChange=function(t){this.waitTime<=0&&this.wasKeyDown&&!m.KeyboardInput.IsKeyDown(m.Keys.S)&&t.ChangeState(new g.TitleState)},g.MapTile={Grass:0,Water:1,Level:2,Road:3,Decoration:4},g.MapState=function(){this.camera=new m.Camera,this.Level=[],this.Data=[],this.XMario=0,this.YMario=0,this.XMarioA=0,this.YMarioA=0,this.MoveTime=0,this.LevelId=0,this.Farthest=0,this.XFarthestCap=0,this.YFarthestCap=0,this.MapImage=document.createElement("canvas"),this.MapImage.width=320,this.MapImage.height=240,this.MapContext=this.MapImage.getContext("2d"),this.CanEnterLevel=!1,this.EnterLevel=!1,this.LevelDifficulty=0,this.LevelType=0,this.WorldNumber=-1,this.NextWorld()},g.MapState.prototype=new m.GameState,g.MapState.prototype.Enter=function(){this.WaterSprite=new m.AnimatedSprite,this.WaterSprite.Image=m.Resources.Images.worldMap,this.WaterSprite.SetColumnCount(16),this.WaterSprite.SetRowCount(16),this.WaterSprite.AddNewSequence("loop",14,0,14,3),this.WaterSprite.FramesPerSecond=1/3,this.WaterSprite.PlaySequence("loop",!0),this.WaterSprite.X=0,this.WaterSprite.Y=0,this.DecoSprite=new m.AnimatedSprite,this.DecoSprite.Image=m.Resources.Images.worldMap,this.DecoSprite.SetColumnCount(16),this.DecoSprite.SetRowCount(16),this.DecoSprite.AddNewSequence("world0",10,0,10,3),this.DecoSprite.AddNewSequence("world1",11,0,11,3),this.DecoSprite.AddNewSequence("world2",12,0,12,3),this.DecoSprite.AddNewSequence("world3",13,0,13,3),this.DecoSprite.FramesPerSecond=1/3,this.DecoSprite.PlaySequence("world0",!0),this.DecoSprite.X=0,this.DecoSprite.Y=0,this.HelpSprite=new m.AnimatedSprite,this.HelpSprite.Image=m.Resources.Images.worldMap,this.HelpSprite.SetColumnCount(16),this.HelpSprite.SetRowCount(16),this.HelpSprite.AddNewSequence("help",7,3,7,5),this.HelpSprite.FramesPerSecond=.5,this.HelpSprite.PlaySequence("help",!0),this.HelpSprite.X=0,this.HelpSprite.Y=0,this.SmallMario=new m.AnimatedSprite,this.SmallMario.Image=m.Resources.Images.worldMap,this.SmallMario.SetColumnCount(16),this.SmallMario.SetRowCount(16),this.SmallMario.AddNewSequence("small",1,0,1,1),this.SmallMario.FramesPerSecond=1/3,this.SmallMario.PlaySequence("small",!0),this.SmallMario.X=0,this.SmallMario.Y=0,this.LargeMario=new m.AnimatedSprite,this.LargeMario.Image=m.Resources.Images.worldMap,this.LargeMario.SetColumnCount(16),this.LargeMario.SetRowCount(8),this.LargeMario.AddNewSequence("large",0,2,0,3),this.LargeMario.AddNewSequence("fire",0,4,0,5),this.LargeMario.FramesPerSecond=1/3,this.LargeMario.PlaySequence("large",!0),this.LargeMario.X=0,this.LargeMario.Y=0,this.FontShadow=g.SpriteCuts.CreateBlackFont(),this.Font=g.SpriteCuts.CreateWhiteFont(),this.DecoSprite.PlaySequence("world"+this.WorldNumber%4,!0),g.MarioCharacter.Fire?this.LargeMario.PlaySequence("fire",!0):this.LargeMario.PlaySequence("large",!0),this.EnterLevel=!1,this.LevelDifficulty=0,this.LevelType=0,g.PlayMapMusic()},g.MapState.prototype.Exit=function(){g.StopMusic(),delete this.WaterSprite,delete this.DecoSprite,delete this.HelpSprite,delete this.SmallMario,delete this.LargeMario,delete this.FontShadow,delete this.Font},g.MapState.prototype.NextWorld=function(){var t=!1;if(this.WorldNumber++,8!==this.WorldNumber){for(this.MoveTime=0,this.LevelId=0,this.Farthest=0,this.XFarthestCap=0,this.YFarthestCap=0;!t;)t=this.GenerateLevel();this.RenderStatic()}},g.MapState.prototype.GenerateLevel=function(){var t=0,e=0,i=0,s=new g.ImprovedNoise(0x8000000000000000*Math.random()|0),h=new g.ImprovedNoise(0x8000000000000000*Math.random()|0),a=new g.ImprovedNoise(0x8000000000000000*Math.random()|0);this.Level=[],this.Data=[];var r=512*Math.random(),n=512*Math.random(),o=512*Math.random(),l=512*Math.random();for(t=0;t<21;t++)for(this.Level[t]=[],this.Data[t]=[],e=0;e<16;e++)i=2*(s.PerlinNoise(10*t+r,10*e+n)-h.PerlinNoise(10*t+o,10*e+l)),this.Level[t][e]=i>0?g.MapTile.Water:g.MapTile.Grass;var c=9999,d=9999,u=0;for(i=0,u=0;u<100&&i<12;u++)t=3*(6*Math.random()|0)+2,e=3*(5*Math.random()|0)+1,this.Level[t][e]===g.MapTile.Grass&&(t<c&&(c=t,d=e),this.Level[t][e]=g.MapTile.Level,this.Data[t][e]=-1,i++);this.Data[c][d]=-2;for(var p=!0;p;)p=this.FindConnection(21,16);if(this.FindCaps(21,16),0===this.XFarthestCap)return!1;for(this.Data[this.XFarthestCap][this.YFarthestCap]=-2,this.Data[this.XMario/16|0][this.YMario/16|0]=-11,t=0;t<21;t++)for(e=0;e<16;e++)this.Level[t][e]!==g.MapTile.Grass||t===this.XFarthestCap&&e===this.YFarthestCap-1||a.PerlinNoise(10*t+r,10*e+n)>0&&(this.Level[t][e]=g.MapTile.Decoration);return!0},g.MapState.prototype.FindConnection=function(t,e){var i=0,s=0;for(i=0;i<t;i++)for(s=0;s<e;s++)if(this.Level[i][s]===g.MapTile.Level&&-1===this.Data[i][s])return this.Connect(i,s,t,e),!0;return!1},g.MapState.prototype.Connect=function(t,e,i,s){var h=1e4,a=0,r=0,n=0,o=0,l=0,c=0,d=0;for(n=0;n<i;n++)for(o=0;o<s;o++)this.Level[n][o]===g.MapTile.Level&&-2===this.Data[n][o]&&(d=(l=0|Math.abs(t-n))*l+(c=0|Math.abs(e-o))*c)<h&&(a=n,r=o,h=d);this.DrawRoad(t,e,a,r),this.Level[t][e]=g.MapTile.Level,this.Data[t][e]=-2},g.MapState.prototype.DrawRoad=function(t,e,i,s){var h=!1;if(Math.random()>.5&&(h=!0),h){for(;t>i;)this.Data[t][e]=0,this.Level[t--][e]=g.MapTile.Road;for(;t<i;)this.Data[t][e]=0,this.Level[t++][e]=g.MapTile.Road}for(;e>s;)this.Data[t][e]=0,this.Level[t][e--]=g.MapTile.Road;for(;e<s;)this.Data[t][e]=0,this.Level[t][e++]=g.MapTile.Road;if(!h){for(;t>i;)this.Data[t][e]=0,this.Level[t--][e]=g.MapTile.Road;for(;t<i;)this.Data[t][e]=0,this.Level[t++][e]=g.MapTile.Road}},g.MapState.prototype.FindCaps=function(t,e){var i=0,s=0,h=-1,a=-1,r=0,n=0,o=0;for(i=0;i<t;i++)for(s=0;s<e;s++)if(this.Level[i][s]===g.MapTile.Level){for(r=0,n=i-1;n<=i+1;n++)for(o=s-1;o<=s+1;o++)this.Level[n][o]===g.MapTile.Road&&r++;1===r?(-1===h&&(h=i,a=s),this.Data[i][s]=0):this.Data[i][s]=1}this.XMario=16*h,this.YMario=16*a,this.Travel(h,a,-1,0)},g.MapState.prototype.Travel=function(t,e,i,s){if(this.Level[t][e]===g.MapTile.Road||this.Level[t][e]===g.MapTile.Level){if(this.Level[t][e]===g.MapTile.Road){if(1===this.Data[t][e])return;this.Data[t][e]=1}this.Level[t][e]===g.MapTile.Level&&(this.Data[t][e]>0?0!==this.LevelId&&0===(4*Math.random()|0)?this.Data[t][e]=-3:this.Data[t][e]=++this.LevelId:s>0&&(this.Data[t][e]=-1,s>this.Farthest&&(this.Farthest=s,this.XFarthestCap=t,this.YFarthestCap=e))),2!==i&&this.Travel(t-1,e,0,s++),3!==i&&this.Travel(t,e-1,1,s++),0!==i&&this.Travel(t+1,e,2,s++),1!==i&&this.Travel(t,e+1,3,s++)}},g.MapState.prototype.RenderStatic=function(){var t=0,e=0,i=0,s=0,h=0,a=m.Resources.Images.worldMap,r=0;for(t=0;t<20;t++)for(e=0;e<15;e++)if(this.MapContext.drawImage(a,16*(this.WorldNumber/4|0),0,16,16,16*t,16*e,16,16),this.Level[t][e]===g.MapTile.Level)0===(r=this.Data[t][e])?this.MapContext.drawImage(a,0,112,16,16,16*t,16*e,16,16):-1===r?this.MapContext.drawImage(a,48,128,16,16,16*t,16*e,16,16):-3===r?this.MapContext.drawImage(a,0,128,16,16,16*t,16*e,16,16):-10===r?this.MapContext.drawImage(a,16,128,16,16,16*t,16*e,16,16):-11===r?this.MapContext.drawImage(a,16,112,16,16,16*t,16*e,16,16):-2===r?(this.MapContext.drawImage(a,32,112,16,16,16*t,16*(e-1),16,16),this.MapContext.drawImage(a,32,128,16,16,16*t,16*e,16,16)):this.MapContext.drawImage(a,16*(r-1),96,16,16,16*t,16*e,16,16);else if(this.Level[t][e]===g.MapTile.Road)i=(this.IsRoad(t-1,e)?1:0)+2*(this.IsRoad(t,e-1)?1:0)+4*(this.IsRoad(t+1,e)?1:0)+8*(this.IsRoad(t,e+1)?1:0),this.MapContext.drawImage(a,16*i,32,16,16,16*t,16*e,16,16);else if(this.Level[t][e]===g.MapTile.Water)for(s=0;s<2;s++)for(h=0;h<2;h++)(i=(this.IsWater(2*t+(s-1),2*e+(h-1))?0:1)+2*(this.IsWater(2*t+s,2*e+(h-1))?0:1)+4*(this.IsWater(2*t+(s-1),2*e+h)?0:1)+8*(this.IsWater(2*t+s,2*e+h)?0:1)-1)>=0&&i<=14&&this.MapContext.drawImage(a,16*i,16*(4+(s+h&1)),16,16,16*t+8*s,16*e+8*h,16,16)},g.MapState.prototype.IsRoad=function(t,e){return t<0&&(t=0),e<0&&(e=0),this.Level[t][e]===g.MapTile.Road||this.Level[t][e]===g.MapTile.Level},g.MapState.prototype.IsWater=function(t,e){var i=0,s=0;for(t<0&&(t=0),e<0&&(e=0),i=0;i<2;i++)for(s=0;s<2;s++)if(this.Level[(t+i)/2|0][(e+s)/2|0]!==g.MapTile.Water)return!1;return!0},g.MapState.prototype.Update=function(t){var e,i,s=0,h=0;8!==this.WorldNumber&&(this.XMario+=this.XMarioA,this.YMario+=this.YMarioA,e=this.XMario/16|0,i=this.YMario/16|0,this.Level[e][i]===g.MapTile.Road&&(this.Data[e][i]=0),this.MoveTime>0?this.MoveTime--:(this.XMarioA=0,this.YMarioA=0,this.CanEnterLevel&&m.KeyboardInput.IsKeyDown(m.Keys.S)&&this.Level[e][i]===g.MapTile.Level&&-11!==this.Data[e][i]&&this.Level[e][i]===g.MapTile.Level&&0!==this.Data[e][i]&&this.Data[e][i]>-10&&(s=this.WorldNumber+1,g.MarioCharacter.LevelString=s+"-",h=g.LevelType.Overground,this.Data[e][i]>1&&0===(3*Math.random()|0)&&(h=g.LevelType.Underground),this.Data[e][i]<0?(-2===this.Data[e][i]?(g.MarioCharacter.LevelString+="X",s+=2):-1===this.Data[e][i]?g.MarioCharacter.LevelString+="?":(g.MarioCharacter.LevelString+="#",s+=1),h=g.LevelType.Castle):g.MarioCharacter.LevelString+=this.Data[e][i],this.EnterLevel=!0,this.LevelDifficulty=s,this.LevelType=h),this.CanEnterLevel=!m.KeyboardInput.IsKeyDown(m.Keys.S),m.KeyboardInput.IsKeyDown(m.Keys.Left)&&this.TryWalking(-1,0),m.KeyboardInput.IsKeyDown(m.Keys.Right)&&this.TryWalking(1,0),m.KeyboardInput.IsKeyDown(m.Keys.Up)&&this.TryWalking(0,-1),m.KeyboardInput.IsKeyDown(m.Keys.Down)&&this.TryWalking(0,1)),this.WaterSprite.Update(t),this.DecoSprite.Update(t),this.HelpSprite.Update(t),g.MarioCharacter.Large?(this.LargeMario.X=this.XMario+this.XMarioA*t|0,this.LargeMario.Y=this.YMario+(this.YMarioA*t|0)-22,this.LargeMario.Update(t)):(this.SmallMario.X=this.XMario+this.XMarioA*t|0,this.SmallMario.Y=this.YMario+(this.YMarioA*t|0)-6,this.SmallMario.Update(t)))},g.MapState.prototype.TryWalking=function(t,e){var i=this.XMario/16|0,s=this.YMario/16|0,h=i+t,a=s+e;if(this.Level[h][a]===g.MapTile.Road||this.Level[h][a]===g.MapTile.Level){if(this.Level[h][a]===g.MapTile.Road&&0!==this.Data[h][a]&&0!==this.Data[i][s]&&this.Data[i][s]>-10)return;this.XMarioA=8*t,this.YMarioA=8*e,this.MoveTime=2*this.CalcDistance(i,s,t,e)+1}},g.MapState.prototype.CalcDistance=function(t,e,i,s){for(var h=0;;){if(t+=i,e+=s,this.Level[t][e]!==g.MapTile.Road)return h;if(this.Level[t-s][e+i]===g.MapTile.Road)return h;if(this.Level[t+s][e-i]===g.MapTile.Road)return h;h++}},g.MapState.prototype.Draw=function(t){var e=0,i=0;if(8!==this.WorldNumber){for(t.drawImage(this.MapImage,0,0),i=0;i<=15;i++)for(e=20;e>=0;e--)this.Level[e][i]===g.MapTile.Water?this.IsWater(2*e-1,2*i-1)&&(this.WaterSprite.X=16*e-8,this.WaterSprite.Y=16*i-8,this.WaterSprite.Draw(t,this.camera)):this.Level[e][i]===g.MapTile.Decoration?(this.DecoSprite.X=16*e,this.DecoSprite.Y=16*i,this.DecoSprite.Draw(t,this.camera)):this.Level[e][i]===g.MapTile.Level&&-2===this.Data[e][i]&&(this.HelpSprite.X=16*e+16,this.HelpSprite.Y=16*i-16,this.HelpSprite.Draw(t,this.camera));g.MarioCharacter.Large?this.LargeMario.Draw(t,this.camera):this.SmallMario.Draw(t,this.camera),this.Font.Strings[0]={String:"MARIO "+g.MarioCharacter.Lives,X:4,Y:4},this.FontShadow.Strings[0]={String:"MARIO "+g.MarioCharacter.Lives,X:5,Y:5},this.Font.Strings[1]={String:"WORLD "+(this.WorldNumber+1),X:256,Y:4},this.FontShadow.Strings[1]={String:"WORLD "+(this.WorldNumber+1),X:257,Y:5},this.FontShadow.Draw(t,this.camera),this.Font.Draw(t,this.camera)}},g.MapState.prototype.LevelWon=function(){var t=this.XMario/16,e=this.YMario/16;-2!==this.Data[t][e]?(-3!==this.Data[t][e]?this.Data[t][e]=0:this.Data[t][e]=-10,this.RenderStatic()):this.NextWorld()},g.MapState.prototype.GetX=function(){return 160},g.MapState.prototype.GetY=function(){return 120},g.MapState.prototype.CheckForChange=function(t){8===this.WorldNumber&&t.ChangeState(new g.WinState),this.EnterLevel&&t.ChangeState(new g.LevelState(this.LevelDifficulty,this.LevelType))},g.LevelState=function(t,e){this.LevelDifficulty=t,this.LevelType=e,this.Level=null,this.Layer=null,this.BgLayer=[],this.Paused=!1,this.Sprites=null,this.SpritesToAdd=null,this.SpritesToRemove=null,this.Camera=null,this.ShellsToCheck=null,this.FireballsToCheck=null,this.FontShadow=null,this.Font=null,this.TimeLeft=0,this.StartTime=0,this.FireballsOnScreen=0,this.Tick=0,this.Delta=0,this.GotoMapState=!1,this.GotoLoseState=!1},g.LevelState.prototype=new m.GameState,g.LevelState.prototype.Enter=function(){var t=new g.LevelGenerator(320,15),e=0,i=0,s=0,h=0,a=null;for(this.Level=t.CreateLevel(this.LevelType,this.LevelDifficulty),this.LevelType===g.LevelType.Overground?g.PlayOvergroundMusic():this.LevelType===g.LevelType.Underground?g.PlayUndergroundMusic():this.LevelType===g.LevelType.Castle&&g.PlayCastleMusic(),this.Paused=!1,this.Layer=new g.LevelRenderer(this.Level,320,240),this.Sprites=new m.DrawableManager,this.Camera=new m.Camera,this.Tick=0,this.ShellsToCheck=[],this.FireballsToCheck=[],this.SpritesToAdd=[],this.SpritesToRemove=[],this.FontShadow=g.SpriteCuts.CreateBlackFont(),this.Font=g.SpriteCuts.CreateWhiteFont(),e=0;e<2;e++)i=4>>e,s=320+((16*this.Level.Width-320)/i|0),h=240+((16*this.Level.Height-240)/i|0),a=new g.BackgroundGenerator(s/32+1,h/32+1,0===e,this.LevelType),this.BgLayer[e]=new g.BackgroundRenderer(a.CreateLevel(),320,240,i);g.MarioCharacter.Initialize(this),this.Sprites.Add(g.MarioCharacter),this.StartTime=1,this.TimeLeft=200,this.GotoMapState=!1,this.GotoLoseState=!1,f()(document).trigger("enterLevel")},g.LevelState.prototype.Exit=function(){delete this.Level,delete this.Layer,delete this.BgLayer,delete this.Sprites,delete this.Camera,delete this.ShellsToCheck,delete this.FireballsToCheck,delete this.FontShadow,delete this.Font},g.LevelState.prototype.CheckShellCollide=function(t){this.ShellsToCheck.push(t)},g.LevelState.prototype.CheckFireballCollide=function(t){this.FireballsToCheck.push(t)},g.LevelState.prototype.Update=function(t){var e=0,i=0,s=0,h=0,a=null,r=!1,n=0,o=0,l=0,c=null,d=0;for(this.Delta=t,this.TimeLeft-=t,0===(0|this.TimeLeft)&&g.MarioCharacter.Die(),this.StartTime>0&&this.StartTime++,this.Camera.X=g.MarioCharacter.X-160,this.Camera.X<0&&(this.Camera.X=0),this.Camera.X>16*this.Level.Width-320&&(this.Camera.X=16*this.Level.Width-320),this.FireballsOnScreen=0,e=0;e<this.Sprites.Objects.length;e++)(a=this.Sprites.Objects[e])!==g.MarioCharacter&&(s=a.X-this.Camera.X,h=a.Y-this.Camera.Y,s<-64||s>384||h<-64||h>304?this.Sprites.RemoveAt(e):a instanceof g.Fireball&&this.FireballsOnScreen++);if(this.Paused)for(e=0;e<this.Sprites.Objects.length;e++)this.Sprites.Objects[e]===g.MarioCharacter?this.Sprites.Objects[e].Update(t):this.Sprites.Objects[e].UpdateNoMove(t);else{for(this.Layer.Update(t),this.Level.Update(),r=!1,0,this.Tick++,n=(this.Camera.X/16|0)-1;n<=1+((this.Camera.X+this.Layer.Width)/16|0);n++)for(o=(this.Camera.Y/16|0)-1;o<=1+((this.Camera.Y+this.Layer.Height)/16|0);o++)if(l=0,16*n+8>g.MarioCharacter.X+16&&(l=-1),16*n+8<g.MarioCharacter.X-16&&(l=1),null!==(c=this.Level.GetSpriteTemplate(n,o))&&(c.LastVisibleTick!==this.Tick-1&&(null!==c.Sprite&&this.Sprites.Contains(c.Sprite)||c.Spawn(this,n,o,l)),c.LastVisibleTick=this.Tick),0!==l&&(d=this.Level.GetBlock(n,o),(g.Tile.Behaviors[255&d]&g.Tile.Animated)>0&&3===(d%16/4|0)&&0===(d/16|0)&&(this.Tick-2*n)%100===0)){for(n,e=0;e<8;e++)this.AddSprite(new g.Sparkle(this,16*n+8,16*o+(16*Math.random()|0),Math.random()*l,0,0,1,5));this.AddSprite(new g.BulletBill(this,16*n+8+8*l,16*o+15,l)),r=!0}for(r&&m.Resources.PlaySound("cannon"),e=0;e<this.Sprites.Objects.length;e++)this.Sprites.Objects[e].Update(t);for(e=0;e<this.Sprites.Objects.length;e++)this.Sprites.Objects[e].CollideCheck();for(e=0;e<this.ShellsToCheck.length;e++)for(i=0;i<this.Sprites.Objects.length;i++)this.Sprites.Objects[i]===this.ShellsToCheck[e]||this.ShellsToCheck[e].Dead||this.Sprites.Objects[i].ShellCollideCheck(this.ShellsToCheck[e])&&(g.MarioCharacter.Carried!==this.ShellsToCheck[e]||this.ShellsToCheck[e].Dead||(g.MarioCharacter.Carried=null,this.ShellsToCheck[e].Die()));for(this.ShellsToCheck.length=0,e=0;e<this.FireballsToCheck.length;e++)for(i=0;i<this.Sprites.Objects.length;i++)this.Sprites.Objects[i]===this.FireballsToCheck[e]||this.FireballsToCheck[e].Dead||this.Sprites.Objects[i].FireballCollideCheck(this.FireballsToCheck[e])&&this.FireballsToCheck[e].Die();this.FireballsToCheck.length=0}this.Sprites.AddRange(this.SpritesToAdd),this.Sprites.RemoveList(this.SpritesToRemove),this.SpritesToAdd.length=0,this.SpritesToRemove.length=0,this.Camera.X=g.MarioCharacter.XOld+(g.MarioCharacter.X-g.MarioCharacter.XOld)*t-160,this.Camera.Y=g.MarioCharacter.YOld+(g.MarioCharacter.Y-g.MarioCharacter.YOld)*t-120},g.LevelState.prototype.Draw=function(t){var e=0,i=0,s=0;for(this.Camera.X<0&&(this.Camera.X=0),this.Camera.Y<0&&(this.Camera.Y=0),this.Camera.X>16*this.Level.Width-320&&(this.Camera.X=16*this.Level.Width-320),this.Camera.Y>16*this.Level.Height-240&&(this.Camera.Y=16*this.Level.Height-240),e=0;e<2;e++)this.BgLayer[e].Draw(t,this.Camera);for(t.save(),t.translate(-this.Camera.X,-this.Camera.Y),e=0;e<this.Sprites.Objects.length;e++)0===this.Sprites.Objects[e].Layer&&this.Sprites.Objects[e].Draw(t,this.Camera);for(t.restore(),this.Layer.Draw(t,this.Camera),this.Layer.DrawExit0(t,this.Camera,0===g.MarioCharacter.WinTime),t.save(),t.translate(-this.Camera.X,-this.Camera.Y),e=0;e<this.Sprites.Objects.length;e++)1===this.Sprites.Objects[e].Layer&&this.Sprites.Objects[e].Draw(t,this.Camera);t.restore(),this.Layer.DrawExit1(t,this.Camera),this.DrawStringShadow(t,"MARIO "+g.MarioCharacter.Lives,0,0),this.DrawStringShadow(t,"00000000",0,1),this.DrawStringShadow(t,"COIN",14,0),this.DrawStringShadow(t," "+g.MarioCharacter.Coins,14,1),this.DrawStringShadow(t,"WORLD",24,0),this.DrawStringShadow(t," "+g.MarioCharacter.LevelString,24,1),this.DrawStringShadow(t,"TIME",34,0),(i=0|this.TimeLeft)<0&&(i=0),this.DrawStringShadow(t," "+i,34,1),this.StartTime>0&&(s=(s=this.StartTime+this.Delta-2)*s*.6,this.RenderBlackout(t,160,120,0|s)),g.MarioCharacter.WinTime>0&&(g.StopMusic(),(s=(s=g.MarioCharacter.WinTime+this.Delta)*s*.2)>900&&(g.GlobalMapState.LevelWon(),this.GotoMapState=!0),this.RenderBlackout(t,g.MarioCharacter.XDeathPos-this.Camera.X|0,g.MarioCharacter.YDeathPos-this.Camera.Y|0,320-s|0)),g.MarioCharacter.DeathTime>0&&(g.StopMusic(),(s=(s=g.MarioCharacter.DeathTime+this.Delta)*s*.1)>900&&(g.MarioCharacter.Lives--,this.GotoMapState=!0,g.MarioCharacter.Lives<=0&&(this.GotoLoseState=!0)),this.RenderBlackout(t,g.MarioCharacter.XDeathPos-this.Camera.X|0,g.MarioCharacter.YDeathPos-this.Camera.Y|0,320-s|0))},g.LevelState.prototype.DrawStringShadow=function(t,e,i,s){this.Font.Strings[0]={String:e,X:8*i+4,Y:8*s+4},this.FontShadow.Strings[0]={String:e,X:8*i+5,Y:8*s+5},this.FontShadow.Draw(t,this.Camera),this.Font.Draw(t,this.Camera)},g.LevelState.prototype.RenderBlackout=function(t,e,i,s){if(!(s>320)){var h=[],a=[],r=0;for(r=0;r<16;r++)h[r]=e+Math.cos(r*Math.PI/15)*s|0,a[r]=i+Math.sin(r*Math.PI/15)*s|0;for(h[16]=0,a[16]=i,h[17]=0,a[17]=240,h[18]=320,a[18]=240,h[19]=320,a[19]=i,t.fillStyle="#000",t.beginPath(),t.moveTo(h[19],a[19]),r=18;r>=0;r--)t.lineTo(h[r],a[r]);for(t.closePath(),t.fill(),r=0;r<16;r++)h[r]=e-Math.cos(r*Math.PI/15)*s|0,a[r]=i-Math.sin(r*Math.PI/15)*s|0;for(a[15]+=5,h[16]=320,a[16]=i,h[17]=320,a[17]=0,h[18]=0,a[18]=0,h[19]=0,a[19]=i,t.fillStyle="#000",t.beginPath(),t.moveTo(h[0],a[0]),r=0;r<=h.length-1;r++)t.lineTo(h[r],a[r]);t.closePath(),t.fill()}},g.LevelState.prototype.AddSprite=function(t){this.Sprites.Add(t)},g.LevelState.prototype.RemoveSprite=function(t){this.Sprites.Remove(t)},g.LevelState.prototype.Bump=function(t,e,i){var s=this.Level.GetBlock(t,e),h=0,a=0;if((g.Tile.Behaviors[255&s]&g.Tile.Bumpable)>0&&(this.BumpInto(t,e-1),this.Level.SetBlock(t,e,4),this.Level.SetBlockData(t,e,4),(g.Tile.Behaviors[255&s]&g.Tile.Special)>0?(m.Resources.PlaySound("sprout"),g.MarioCharacter.Large?this.AddSprite(new g.FireFlower(this,16*t+8,16*e+8)):this.AddSprite(new g.Mushroom(this,16*t+8,16*e+8))):(g.MarioCharacter.GetCoin(),m.Resources.PlaySound("coin"),this.AddSprite(new g.CoinAnim(this,t,e)))),(g.Tile.Behaviors[255&s]&g.Tile.Breakable)>0&&(this.BumpInto(t,e-1),i))for(m.Resources.PlaySound("breakblock"),this.Level.SetBlock(t,e,0),h=0;h<2;h++)for(a=0;a<2;a++)this.AddSprite(new g.Particle(this,16*t+8*h+4,16*e+8*a+4,4*(2*h-1),4*(2*a-1)-8))},g.LevelState.prototype.BumpInto=function(t,e){var i=this.Level.GetBlock(t,e),s=0;for((g.Tile.Behaviors[255&i]&g.Tile.PickUpable)>0&&(g.MarioCharacter.GetCoin(),m.Resources.PlaySound("coin"),this.Level.SetBlock(t,e,0),this.AddSprite(new g.CoinAnim(t,e+1))),s=0;s<this.Sprites.Objects.length;s++)this.Sprites.Objects[s].BumpCheck(t,e)},g.LevelState.prototype.CheckForChange=function(t){this.GotoLoseState?t.ChangeState(new g.LoseState):this.GotoMapState&&(t.ChangeState(g.GlobalMapState),f()(document).trigger("enterGame"))};var v=window.MIDIjs||{},y={title:"midi/title.mid",map:"midi/map.mid",background:"midi/background.mid",overground:"midi/overground.mid",underground:"midi/underground.mid",castle:"midi/castle.mid"};g.PlayMusic=function(t){t in y?(v.stop(),v.play(y[t])):console.error("Cannot play music track "+t+" as i have no data for it.")},g.PlayTitleMusic=function(){g.PlayMusic("title")},g.PlayMapMusic=function(){g.PlayMusic("map")},g.PlayOvergroundMusic=function(){g.PlayMusic("background")},g.PlayUndergroundMusic=function(){g.PlayMusic("underground")},g.PlayCastleMusic=function(){g.PlayMusic("castle")},g.StopMusic=function(){v.stop()},g.runMarioRun=function(){var t=!!("ontouchstart"in window);t?f()("#mobile-controls").show():f()("#mobile-controls").hide(),f()(document).on("enterTitleState",(function(){f()("#control-collection").hide()})),f()(document).on("enterGame",(function(){f()("#control-collection").show(),f()("#btnTop").show(),f()("#btnBottom").show()})),f()(document).on("enterLevel",(function(){f()("#btnTop").hide(),f()("#btnBottom").hide()})),f()(document).ready((function(){window.rMR=new m.Application(t).Initialize(new g.LoadingState(t),320,240),f()("#control-collection").hide()}))},window.rMR={};var M=i(35),w=i(24),C=function(t){function e(t){var i;return Object(n.a)(this,e),(i=Object(l.a)(this,Object(c.a)(e).call(this,t))).state={oracleID:window.localStorage.getItem("oracleID")},i.history=i.props.history,i.teamNames=["Energy Pirates","Auto Rebeles","Retail Rangers","Consumer Seals","Tele Warriors","COE Snipers","Travel Ninjas","Core Battalion","FIN Mafia"],i}return Object(d.a)(e,t),Object(o.a)(e,[{key:"playGame",value:function(){this.history.push("/play")}},{key:"componentDidMount",value:function(){g.StopMusic(),window.localStorage.getItem("oracleID")||this.history.push("/")}},{key:"renderTeamLeaderBoard",value:function(){return h.a.createElement("div",{className:"card"},h.a.createElement("div",{className:"card-header"},h.a.createElement("div",null,"Leading Teams")),h.a.createElement("div",{className:"card-body"},this.teamNames.map((function(t,e){return h.a.createElement("div",{className:"row",key:"team-"+e},h.a.createElement("div",{className:"col-sm-12"},h.a.createElement("div",{className:"team-name"},t)),h.a.createElement("div",{className:"col-sm"},"Attempts",h.a.createElement("br",null),"725"),h.a.createElement("div",{className:"col-sm"},"Highest Level",h.a.createElement("br",null),"7"),h.a.createElement("div",{className:"col-sm"},h.a.createElement("img",{src:"/images/coin-spinner.gif",width:"45",alt:"Coins Collected"})," ",h.a.createElement("br",null),"17856"))}))))}},{key:"renderPeopleBoard",value:function(){return h.a.createElement("div",{className:"card"},h.a.createElement("div",{className:"card-header"},h.a.createElement("div",null,"Top 10 Players")),h.a.createElement("div",{className:"card-body"},this.teamNames.map((function(t,e){return h.a.createElement("div",{className:"row",key:"people-"+e},h.a.createElement("div",{className:"col-sm-12"},h.a.createElement("div",{className:"team-name"},t)),h.a.createElement("div",{className:"col-sm"},"Attempts",h.a.createElement("br",null),"725"),h.a.createElement("div",{className:"col-sm"},"Highest Level",h.a.createElement("br",null),"7"),h.a.createElement("div",{className:"col-sm"},h.a.createElement("img",{src:"/images/coin-spinner.gif",width:"45",alt:"Coins Collected"})," ",h.a.createElement("br",null),"17856"))}))))}},{key:"renderMyTeamScorecard",value:function(){return h.a.createElement("div",{className:"card"},h.a.createElement("div",{className:"card-header"},h.a.createElement("div",null,"My Team Score Card")),h.a.createElement("div",{className:"card-body"},h.a.createElement("div",{className:"row"},h.a.createElement("div",{className:"col-sm"},"Attempts",h.a.createElement("br",null),"725"),h.a.createElement("div",{className:"col-sm"},"Highest Level",h.a.createElement("br",null),"7"),h.a.createElement("div",{className:"col-sm"},h.a.createElement("img",{src:"/images/coin-spinner.gif",width:"45",alt:"Coins Collected"})," ",h.a.createElement("br",null),"17856"))))}},{key:"renderMyScorecard",value:function(){return h.a.createElement("div",{className:"myscore card"},h.a.createElement("div",{className:"card-header"},h.a.createElement("div",null,"My Score Card")),h.a.createElement("div",{className:"card-body"},h.a.createElement("div",{className:"row"},h.a.createElement("div",{className:"col-sm"},"Attempts",h.a.createElement("br",null),"125"),h.a.createElement("div",{className:"col-sm"},"Highest Level",h.a.createElement("br",null),"5"),h.a.createElement("div",{className:"col-sm"},h.a.createElement("img",{src:"/images/coin-spinner.gif",width:"45",alt:"Coins Collected"})," ",h.a.createElement("br",null),"1200"))))}},{key:"render",value:function(){var t=this;return h.a.createElement("section",{className:"leaderboard-container container"},h.a.createElement("section",{className:"greeting"},h.a.createElement("div",{className:"user-info"},"Howdy Abhishek"),h.a.createElement("div",{className:"play-info"},h.a.createElement("button",{className:"btn btn-success",onClick:function(){return t.playGame()}},"Play Now"))),h.a.createElement(M.a,{className:"leaderboard-tabs",defaultActiveKey:"myscore",id:"battleground-mario-leaderboard"},h.a.createElement(w.a,{eventKey:"myscore",title:"Me & My Team"},this.renderMyScorecard(),this.renderMyTeamScorecard()),h.a.createElement(w.a,{eventKey:"peopleboardscore",title:"Rock Stars"},this.renderPeopleBoard()),h.a.createElement(w.a,{eventKey:"leaderboardscore",title:"LeaderBoard"},this.renderTeamLeaderBoard())))}}]),e}(s.Component),X=Object(p.f)(C),Y=function(t){function e(t){var i;return Object(n.a)(this,e),(i=Object(l.a)(this,Object(c.a)(e).call(this,t))).state={oracleID:""},i.history=i.props.history,i}return Object(d.a)(e,t),Object(o.a)(e,[{key:"componentDidMount",value:function(){g.StopMusic(),window.localStorage.getItem("oracleID")>0&&this.history.push("/leaderboard")}},{key:"doLogin",value:function(){window.localStorage.setItem("oracleID",this.state.oracleID),this.history.push("/leaderboard")}},{key:"render",value:function(){var t=this,e="";return e=window.localStorage.getItem("timeup")?h.a.createElement("div",{className:"sorry "},h.a.createElement("h2",{className:"text-danger"},"bye bye.."),"  ",h.a.createElement("div",{class:"small"},"They say its Timeout!! ")):h.a.createElement("form",{className:"form-signin",onSubmit:function(){return t.doLogin()}},h.a.createElement("div",{className:"form-label-group"},h.a.createElement("label",{htmlFor:"oracleID"},"Enter your OracleID"),h.a.createElement("input",{type:"text",id:"oracleID",className:"form-control",placeholder:"e.g. 128687",required:"",autoFocus:"",onChange:function(e){return t.setState({oracleID:e.target.value})}})),h.a.createElement("button",{className:"btn btn-lg btn-success btn-block",type:"submit"},"Login")),h.a.createElement("section",{className:"home-container container"},h.a.createElement("section",{className:"login-div"},e))}}]),e}(s.Component),k=Object(p.f)(Y),I=i(25),T=i.n(I),L=function(t){function e(t){var i;return Object(n.a)(this,e),(i=Object(l.a)(this,Object(c.a)(e).call(this,t))).state={oracleID:window.localStorage.getItem("oracleID")},i.history=i.props.history,0===window.screen.orientation.type.indexOf("landscape")&&document.querySelector("body").setAttribute("class","black-bg"),i}return Object(d.a)(e,t),Object(o.a)(e,[{key:"componentDidMount",value:function(){window.localStorage.getItem("oracleID")||this.history.push("/"),window.addEventListener("orientationchange",this.onOrientationChange),0===window.screen.orientation.type.indexOf("landscape")&&g.runMarioRun()}},{key:"onOrientationChange",value:function(t){console.log(t),t&&(0===t.target.screen.orientation.type.indexOf("landscape")?(document.querySelector("body").setAttribute("class","black-bg"),window.runMarioRun()):(window.Mario.StopMusic(),document.querySelector("body").removeAttribute("class")))}},{key:"componentWillUnmount",value:function(){window.rMR=null,g.StopMusic(),document.querySelector("body").removeAttribute("class")}},{key:"render",value:function(){var t=this;return window.screen.orientation.onchange=this.onOrientationChange(),h.a.createElement("section",{className:"mario-game"},h.a.createElement("button",{className:"btn btn-secondary btn-sm go-back",onClick:function(){return t.history.push("/")}},h.a.createElement("i",{className:"fa fa-chevron-left"})," Back"),h.a.createElement(T.a,{lockOrientation:"landscape"},h.a.createElement(I.Orientation,{orientation:"landscape",alwaysRender:!1},h.a.createElement("canvas",{id:"canvas",width:"640",height:"480"},h.a.createElement("p",null,"Your browser does not support the canvas element.")),h.a.createElement("div",{id:"mobile-controls"},h.a.createElement("div",null,h.a.createElement("div",{id:"control-collection"},h.a.createElement("button",{className:"btn btn-success top",id:"btnTop","data-type":"38"},h.a.createElement("i",{className:"fa fa-chevron-up","aria-hidden":"true"})),h.a.createElement("div",null,h.a.createElement("button",{className:"btn btn-success",id:"btnLeft","data-type":"37"},h.a.createElement("i",{className:"fa fa-chevron-left","aria-hidden":"true"})),h.a.createElement("button",{className:"btn btn-success",id:"btnRight","data-type":"39"},h.a.createElement("i",{className:"fa fa-chevron-right","aria-hidden":"true"}))),h.a.createElement("button",{className:"btn btn-success",id:"btnBottom","data-type":"40"},h.a.createElement("i",{className:"fa fa-chevron-down","aria-hidden":"true"})))),h.a.createElement("button",{className:"btn btn-success right-controls",id:"btnFire","data-type":"65"},"A"),h.a.createElement("button",{className:"btn btn-success right-controls",id:"btnJump","data-type":"83"},"S"))),h.a.createElement(I.Orientation,{orientation:"portrait",alwaysRender:!1},h.a.createElement("div",{className:"cant-play"},h.a.createElement("p",null,"Please rotate your device")))))}}]),e}(s.Component),b=Object(p.f)(L),D={endTime:"2019-12-31T12:33:00+05:30"},W=function(t){function e(t){return Object(n.a)(this,e),Object(l.a)(this,Object(c.a)(e).call(this,t))}return Object(d.a)(e,t),Object(o.a)(e,[{key:"componentDidMount",value:function(){var t=setInterval((function(){return e()}),5e3);function e(){var e=new Date,i=new Date(D.endTime);e.getTime()>i.getTime()?(window.localStorage.removeItem("oracleID"),window.localStorage.setItem("timeup",!0),clearInterval(t),"/"!==window.location.pathname&&(window.location.href="/")):window.localStorage.removeItem("timeup")}e()}},{key:"render",value:function(){return h.a.createElement(u.a,null,h.a.createElement("section",{className:"app-container d-flex"},h.a.createElement(p.c,null,h.a.createElement(p.a,{path:"/leaderboard"},h.a.createElement(X,null)),h.a.createElement(p.a,{path:"/play"},h.a.createElement(b,null)),h.a.createElement(p.a,{path:"/"},h.a.createElement(k,null)))))}}]),e}(s.Component),F=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function B(t,e){navigator.serviceWorker.register(t).then((function(t){t.onupdatefound=function(){var i=t.installing;null!=i&&(i.onstatechange=function(){"installed"===i.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),e&&e.onUpdate&&e.onUpdate(t)):(console.log("Content is cached for offline use."),e&&e.onSuccess&&e.onSuccess(t)))})}})).catch((function(t){console.error("Error during service worker registration:",t)}))}r.a.render(h.a.createElement(W,null),document.getElementById("root")),function(t){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("","/service-worker.js");F?(!function(t,e){fetch(t).then((function(i){var s=i.headers.get("content-type");404===i.status||null!=s&&-1===s.indexOf("javascript")?navigator.serviceWorker.ready.then((function(t){t.unregister().then((function(){window.location.reload()}))})):B(t,e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e,t),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):B(e,t)}))}}()}},[[36,1,2]]]);
//# sourceMappingURL=main.47a752bf.chunk.js.map